<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Portfolio interactif d'Aymen Louraghi â€” Ã‰tudiant BTS SIO SISR passionnÃ© par les rÃ©seaux et la cybersÃ©curitÃ©.">
<meta name="theme-color" content="#0a0e27">
<meta name="author" content="Aymen Louraghi">
<title>Aymen Louraghi â€” Portfolio OS</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’»</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ============================================
   CSS VARIABLES & RESET
   ============================================ */
:root {
  --primary: #00d4ff;
  --primary-dark: #00a0c4;
  --bg-dark: #0a0e27;
  --bg-darker: #060918;
  --bg-card: rgba(15, 20, 50, 0.85);
  --bg-window: #1e1e2e;
  --bg-titlebar: #181825;
  --bg-taskbar: rgba(10, 14, 39, 0.92);
  --text: #e0e0e0;
  --text-muted: #888;
  --text-bright: #ffffff;
  --accent-green: #00e676;
  --accent-red: #ff5252;
  --accent-yellow: #ffc107;
  --accent-orange: #ff9800;
  --accent-purple: #bb86fc;
  --border: rgba(255,255,255,0.08);
  --shadow: 0 8px 32px rgba(0,0,0,0.5);
  --radius: 12px;
  --radius-sm: 8px;
  --font: 'Inter', 'Segoe UI', sans-serif;
  --font-mono: 'JetBrains Mono', 'Consolas', monospace;
  --taskbar-h: 52px;
  --z-lock: 10000;
  --z-window: 100;
  --z-taskbar: 9000;
  --z-start: 9500;
  --z-notification: 9800;
  --z-context: 9900;
  --z-fire: 99998;
  --z-glitch: 99999;
  --z-glitch-text: 100000;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

html, body {
  width:100%; height:100%;
  overflow:hidden;
  font-family: var(--font);
  background: var(--bg-darker);
  color: var(--text);
  user-select: none;
  -webkit-user-select: none;
}

::selection { background: var(--primary); color: var(--bg-dark); }
::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

/* Focus visible for accessibility */
*:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}
button:focus-visible, input:focus-visible { outline-offset: 0; }

/* ============================================
   BOOT SEQUENCE
   ============================================ */
#bootScreen {
  position:fixed; inset:0;
  z-index: 100001;
  background: #000;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  gap:1.5rem;
  transition: opacity 0.6s ease;
}
#bootScreen.hidden {
  opacity:0;
  pointer-events:none;
}
.boot-logo {
  font-size:3rem;
  animation: bootPulse 1.2s ease-in-out infinite;
}
@keyframes bootPulse {
  0%, 100% { opacity:0.4; transform:scale(0.95); }
  50% { opacity:1; transform:scale(1.05); }
}
.boot-text {
  font-family: var(--font-mono);
  font-size:0.8rem;
  color: var(--primary);
  letter-spacing:1px;
}
.boot-progress {
  width:200px; height:3px;
  background: rgba(255,255,255,0.1);
  border-radius:2px;
  overflow:hidden;
}
.boot-progress-fill {
  height:100%;
  background: var(--primary);
  border-radius:2px;
  animation: bootLoad 2s ease-in-out forwards;
}
@keyframes bootLoad {
  0% { width:0%; }
  30% { width:35%; }
  60% { width:65%; }
  80% { width:85%; }
  100% { width:100%; }
}

/* ============================================
   LOCK SCREEN
   ============================================ */
#lockScreen {
  position: fixed; inset:0;
  z-index: var(--z-lock);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 50%, #0d1130 100%);
  transition: transform 0.8s cubic-bezier(0.76, 0, 0.24, 1), opacity 0.6s ease;
}
#lockScreen.unlocked {
  transform: translateY(-100%);
  opacity: 0;
  pointer-events: none;
}
#lockScreen::before {
  content:'';
  position:absolute; inset:0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="g1" cx="30%" cy="40%"><stop offset="0%" stop-color="%2300d4ff" stop-opacity="0.15"/><stop offset="100%" stop-color="transparent"/></radialGradient><radialGradient id="g2" cx="70%" cy="60%"><stop offset="0%" stop-color="%23bb86fc" stop-opacity="0.1"/><stop offset="100%" stop-color="transparent"/></radialGradient></defs><rect fill="url(%23g1)" width="1000" height="1000"/><rect fill="url(%23g2)" width="1000" height="1000"/></svg>');
  background-size: cover;
  filter: blur(0px);
}

.lock-time {
  position: relative; z-index:1;
  font-size: clamp(4rem, 10vw, 7rem);
  font-weight: 300;
  color: var(--text-bright);
  letter-spacing: 2px;
  text-shadow: 0 0 40px rgba(0,212,255,0.3);
}
.lock-date {
  position:relative; z-index:1;
  font-size: clamp(0.9rem, 2vw, 1.2rem);
  color: var(--text-muted);
  margin-bottom: 3rem;
  text-transform: capitalize;
}

.lock-profile {
  position:relative; z-index:1;
  display:flex; flex-direction:column;
  align-items:center; gap:1rem;
}
.lock-avatar {
  width:100px; height:100px;
  border-radius:50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  display:flex; align-items:center; justify-content:center;
  font-size:2.5rem; font-weight:700;
  color: var(--bg-dark);
  box-shadow: 0 0 30px rgba(0,212,255,0.3);
  border: 3px solid rgba(255,255,255,0.15);
}
.lock-username {
  font-size:1.3rem; font-weight:500;
  color: var(--text-bright);
}

.lock-action {
  position:relative; z-index:1;
  margin-top: 1.5rem;
  display: flex; flex-direction:column;
  align-items:center; gap:0.8rem;
}
.lock-input-wrapper {
  display:flex; gap:0;
  border-radius: 25px;
  overflow:hidden;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(20px);
  transition: border-color 0.3s;
}
.lock-input-wrapper:has(.lock-input.shake) {
  border-color: var(--accent-red);
}
.lock-input.shake {
  animation: shakeInput 0.4s ease;
}
@keyframes shakeInput {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  60% { transform: translateX(-5px); }
  80% { transform: translateX(5px); }
}
.lock-input {
  background:transparent; border:none; outline:none;
  color: var(--text);
  padding: 0.7rem 1.2rem;
  font-size:0.9rem;
  width:200px;
  font-family: var(--font);
}
.lock-input::placeholder { color: var(--text-muted); }
.lock-btn {
  padding: 0.7rem 1.5rem;
  background: var(--primary);
  color: var(--bg-dark);
  border:none; cursor:pointer;
  font-weight:600; font-size:0.85rem;
  font-family: var(--font);
  transition: background 0.3s;
}
.lock-btn:hover { background: var(--primary-dark); }

.lock-hint {
  font-size:0.75rem;
  color: var(--text-muted);
  opacity:0.6;
}

/* ============================================
   DESKTOP
   ============================================ */
#desktop {
  position: fixed; inset:0;
  background: linear-gradient(160deg, #0a0e27 0%, #0d1442 30%, #0a0e27 60%, #111640 100%);
  overflow: hidden;
}
#desktop::before {
  content:'';
  position:absolute; inset:0;
  background:
    radial-gradient(ellipse 800px 600px at 20% 30%, rgba(0,212,255,0.08), transparent),
    radial-gradient(ellipse 600px 500px at 75% 70%, rgba(187,134,252,0.06), transparent),
    radial-gradient(ellipse 400px 400px at 50% 50%, rgba(0,230,118,0.03), transparent);
  pointer-events:none;
}

/* Animated particles */
.particles {
  position:absolute; inset:0; overflow:hidden; pointer-events:none;
}
.particle {
  position:absolute;
  width:2px; height:2px;
  background: var(--primary);
  border-radius:50%;
  opacity:0;
  animation: floatParticle linear infinite;
}
@keyframes floatParticle {
  0% { opacity:0; transform: translateY(100vh) scale(0); }
  10% { opacity:0.6; }
  90% { opacity:0.6; }
  100% { opacity:0; transform: translateY(-10vh) scale(1); }
}

/* ============================================
   DESKTOP ICONS
   ============================================ */
.desktop-icons {
  position:absolute;
  top: 20px; left: 20px;
  display: flex; flex-direction: column;
  gap: 8px;
  z-index: 10;
}
.desktop-icon {
  display:flex; flex-direction:column;
  align-items:center; gap:6px;
  padding: 10px 8px;
  border-radius: var(--radius-sm);
  cursor:pointer;
  width: 90px;
  text-align:center;
  transition: background 0.2s;
  border: 1px solid transparent;
}
.desktop-icon:hover {
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.1);
}
.desktop-icon.selected {
  background: rgba(0,212,255,0.12);
  border-color: rgba(0,212,255,0.3);
}
.desktop-icon-img {
  width:48px; height:48px;
  display:flex; align-items:center; justify-content:center;
  font-size:2rem;
  filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
}
.desktop-icon-label {
  font-size:0.72rem;
  color: var(--text-bright);
  text-shadow: 0 1px 4px rgba(0,0,0,0.8);
  line-height:1.3;
  word-break: break-word;
}

/* ============================================
   TASKBAR
   ============================================ */
#taskbar {
  position:fixed; bottom:0; left:0; right:0;
  height: var(--taskbar-h);
  background: var(--bg-taskbar);
  backdrop-filter: blur(30px);
  border-top: 1px solid var(--border);
  display:flex; align-items:center;
  justify-content: space-between;
  padding: 0 12px;
  z-index: var(--z-taskbar);
}
.taskbar-left {
  display:flex; align-items:center; gap: 2px;
}
.taskbar-center {
  display:flex; align-items:center; gap: 2px;
  position:absolute; left:50%; transform:translateX(-50%);
}
.taskbar-right {
  display:flex; align-items:center; gap: 8px;
  font-size:0.75rem; color: var(--text-muted);
}

.taskbar-btn {
  display:flex; align-items:center; justify-content:center;
  height: 40px; min-width: 44px;
  padding: 0 10px;
  border-radius: var(--radius-sm);
  cursor:pointer;
  border:none;
  background:transparent;
  color: var(--text);
  font-size:1.1rem;
  transition: background 0.2s;
  font-family: var(--font);
  position:relative;
}
.taskbar-btn:hover { background: rgba(255,255,255,0.08); }
.taskbar-btn.active {
  background: rgba(255,255,255,0.06);
}
.taskbar-btn.active::after {
  content:'';
  position:absolute; bottom:2px;
  left:50%; transform:translateX(-50%);
  width:20px; height:3px;
  background: var(--primary);
  border-radius:2px;
}
.taskbar-btn.start-btn {
  font-size:1.3rem;
}

.taskbar-clock {
  display:flex; flex-direction:column;
  align-items:flex-end;
  line-height:1.3;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  cursor:pointer;
}
.taskbar-clock:hover { background: rgba(255,255,255,0.06); }
.taskbar-time { font-size:0.8rem; color: var(--text); }
.taskbar-date-small { font-size:0.68rem; color: var(--text-muted); }

.taskbar-tray {
  display:flex; align-items:center; gap:6px;
  padding: 0 6px;
  font-size:0.85rem;
}

/* ============================================
   START MENU
   ============================================ */
#startMenu {
  position:fixed;
  bottom: calc(var(--taskbar-h) + 12px);
  left: 50%; transform: translateX(-50%) scale(0.95);
  width: 600px; max-width: calc(100vw - 24px);
  background: var(--bg-taskbar);
  backdrop-filter: blur(40px);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  z-index: var(--z-start);
  opacity:0;
  pointer-events:none;
  transition: opacity 0.25s, transform 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  padding: 1.5rem;
}
#startMenu.open {
  opacity:1;
  pointer-events:all;
  transform: translateX(-50%) scale(1);
}

.start-search {
  width:100%;
  padding: 0.7rem 1rem;
  border-radius: 25px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  color: var(--text);
  font-family: var(--font);
  font-size:0.85rem;
  outline:none;
  margin-bottom: 1.2rem;
}
.start-search::placeholder { color: var(--text-muted); }
.start-search:focus { border-color: var(--primary); }

.start-section-title {
  font-size:0.8rem; font-weight:600;
  color: var(--text-muted);
  margin-bottom:0.8rem;
  letter-spacing:0.5px;
}
.start-apps {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap:6px;
  margin-bottom: 1.2rem;
}
.start-app {
  display:flex; flex-direction:column;
  align-items:center; gap:6px;
  padding: 12px 8px;
  border-radius: var(--radius-sm);
  cursor:pointer;
  transition: background 0.2s;
}
.start-app:hover { background: rgba(255,255,255,0.08); }
.start-app-icon { font-size:1.6rem; }
.start-app-label { font-size:0.7rem; color: var(--text); text-align:center; }

.start-user {
  display:flex; align-items:center; gap:10px;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}
.start-user-avatar {
  width:32px; height:32px; border-radius:50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  display:flex; align-items:center; justify-content:center;
  font-size:0.8rem; font-weight:700; color: var(--bg-dark);
}
.start-user-name { font-size:0.8rem; color: var(--text); }

/* ============================================
   WINDOW SYSTEM
   ============================================ */
.os-window {
  position: absolute;
  min-width: 400px;
  min-height: 300px;
  background: var(--bg-window);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  display: flex; flex-direction: column;
  overflow: hidden;
  transition: box-shadow 0.2s;
  opacity: 0;
  transform: scale(0.92);
  animation: windowOpen 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
@keyframes windowOpen {
  to { opacity:1; transform: scale(1); }
}
.os-window.closing {
  animation: windowClose 0.25s ease forwards;
}
@keyframes windowClose {
  to { opacity:0; transform: scale(0.92); }
}
.os-window.focused {
  box-shadow: 0 12px 48px rgba(0,0,0,0.6), 0 0 0 1px rgba(0,212,255,0.1);
}
.os-window.minimized {
  transform: scale(0.1) translateY(100vh);
  opacity:0;
  pointer-events:none;
  transition: transform 0.35s cubic-bezier(0.76, 0, 0.24, 1), opacity 0.25s ease;
}
.os-window:not(.minimized) {
  transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.25s ease, box-shadow 0.2s;
}
.os-window.maximized {
  top: 0 !important; left: 0 !important;
  width: 100% !important;
  height: calc(100% - var(--taskbar-h)) !important;
  border-radius: 0;
}

/* Title bar */
.window-titlebar {
  display:flex; align-items:center;
  height: 38px; min-height:38px;
  padding: 0 12px;
  background: var(--bg-titlebar);
  cursor: default;
  gap: 10px;
  border-bottom: 1px solid var(--border);
}
.window-titlebar-icon { font-size:0.9rem; }
.window-titlebar-text {
  flex:1;
  font-size:0.78rem;
  color: var(--text-muted);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.window-controls {
  display:flex; gap:0;
  margin-left:auto;
}
.window-ctrl-btn {
  display:flex; align-items:center; justify-content:center;
  width:36px; height:30px;
  border:none; background:transparent;
  color: var(--text-muted);
  cursor:pointer;
  font-size:0.75rem;
  transition: background 0.15s, color 0.15s;
  border-radius: 4px;
}
.window-ctrl-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }
.window-ctrl-btn.close-btn:hover { background: var(--accent-red); color:#fff; }

/* Window content */
.window-body {
  flex:1;
  overflow: hidden;
  padding: 0;
  position:relative;
  min-height:0;
}

/* Resize handle */
.resize-handle {
  position:absolute; bottom:0; right:0;
  width:16px; height:16px;
  cursor:nwse-resize;
}

/* ============================================
   WINDOW: ACCUEIL (Browser)
   ============================================ */
.browser-toolbar {
  display:flex; align-items:center;
  padding: 6px 10px;
  background: rgba(0,0,0,0.2);
  gap: 8px;
  border-bottom: 1px solid var(--border);
}
.browser-nav-btn {
  width:28px; height:28px;
  border-radius:50%;
  border:none;
  background:transparent;
  color: var(--text-muted);
  cursor:pointer;
  font-size:0.8rem;
  display:flex; align-items:center; justify-content:center;
}
.browser-nav-btn:hover { background: rgba(255,255,255,0.08); }
.browser-url {
  flex:1;
  padding: 5px 12px;
  border-radius: 20px;
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--border);
  color: var(--text-muted);
  font-size:0.75rem;
  font-family: var(--font);
  outline:none;
}

.accueil-content {
  padding: 2.5rem;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  min-height: 100%;
  text-align:center;
  overflow-y:auto;
}
.accueil-greeting {
  font-size:0.9rem;
  color: var(--primary);
  font-weight:600;
  letter-spacing:2px;
  text-transform:uppercase;
  margin-bottom:0.8rem;
}
.accueil-title {
  font-size: clamp(1.5rem, 3vw, 2.2rem);
  font-weight:700;
  color: var(--text-bright);
  margin-bottom:1rem;
  line-height:1.3;
}
.accueil-title .highlight { color: var(--primary); }

.terminal-text {
  font-family: var(--font-mono);
  font-size: 0.9rem;
  color: var(--accent-green);
  background: rgba(0,0,0,0.4);
  padding: 1.2rem 1.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid rgba(0,230,118,0.15);
  max-width: 600px;
  width:100%;
  text-align:left;
  min-height: 80px;
  position:relative;
}
.terminal-text .cursor {
  display:inline-block;
  width:8px; height:1.1em;
  background: var(--accent-green);
  animation: blink 1s step-end infinite;
  vertical-align: text-bottom;
  margin-left:2px;
}
@keyframes blink { 50% { opacity:0; } }

.terminal-text .prompt { color: var(--primary); }

.accueil-tags {
  display:flex; flex-wrap:wrap; gap:8px;
  margin-top:1.5rem;
  justify-content:center;
}
.accueil-tag {
  padding: 5px 14px;
  border-radius:20px;
  background: rgba(0,212,255,0.1);
  border: 1px solid rgba(0,212,255,0.2);
  color: var(--primary);
  font-size:0.75rem;
  font-weight:500;
}

/* ============================================
   WINDOW: Ã€ PROPOS (Code Editor)
   ============================================ */
.editor-container {
  display:flex; height:100%;
}
.editor-sidebar {
  width:46px;
  background: rgba(0,0,0,0.3);
  display:flex; flex-direction:column;
  align-items:center;
  padding-top:10px; gap:14px;
  border-right: 1px solid var(--border);
}
.editor-sidebar-icon {
  width:28px; height:28px;
  display:flex; align-items:center; justify-content:center;
  color: var(--text-muted);
  font-size:0.85rem;
  cursor:pointer;
  border-radius:4px;
  transition: color 0.2s;
}
.editor-sidebar-icon:hover { color: var(--text); }
.editor-sidebar-icon.active {
  color: var(--text-bright);
  border-left: 2px solid var(--primary);
}

.editor-tabs {
  display:flex;
  background: rgba(0,0,0,0.2);
  border-bottom: 1px solid var(--border);
}
.editor-tab {
  padding: 8px 16px;
  font-size:0.75rem;
  color: var(--text-muted);
  cursor:pointer;
  border-right: 1px solid var(--border);
  display:flex; align-items:center; gap:6px;
  transition: background 0.2s;
}
.editor-tab.active {
  background: var(--bg-window);
  color: var(--text);
  border-bottom: 1px solid var(--primary);
  margin-bottom:-1px;
}

.editor-main { flex:1; display:flex; flex-direction:column; }
.editor-code {
  flex:1; overflow:auto;
  padding: 1rem;
  font-family: var(--font-mono);
  font-size: 0.82rem;
  line-height:1.7;
  counter-reset: line;
}
.code-line {
  display:flex; gap:1rem;
}
.code-line::before {
  counter-increment: line;
  content: counter(line);
  color: var(--text-muted);
  opacity:0.4;
  min-width:2.5em;
  text-align:right;
  font-size:0.78rem;
}
.code-line .kw { color: var(--accent-purple); }
.code-line .str { color: #ce9178; }
.code-line .fn { color: #dcdcaa; }
.code-line .cm { color: #6a9955; }
.code-line .num { color: #b5cea8; }
.code-line .prop { color: #9cdcfe; }
.code-line .type { color: #4ec9b0; }

/* ============================================
   WINDOW: RÃ‰ALISATIONS (File Explorer)
   ============================================ */
.explorer-toolbar {
  display:flex; align-items:center;
  padding: 6px 12px;
  background: rgba(0,0,0,0.15);
  border-bottom: 1px solid var(--border);
  gap:8px;
}
.explorer-breadcrumb {
  font-size:0.75rem;
  color: var(--text-muted);
  display:flex; align-items:center; gap:4px;
}
.explorer-breadcrumb span { color: var(--text); cursor:pointer; }
.explorer-breadcrumb span:hover { color: var(--primary); }

.explorer-content {
  display:flex; height: calc(100% - 38px);
}
.explorer-files {
  flex:1;
  padding: clamp(0.5rem, 1.5vw, 1.5rem);
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(clamp(80px, 10vw, 150px), 1fr));
  gap: clamp(6px, 1vw, 14px);
  align-content: start;
  overflow:auto;
}
.file-item {
  display:flex; flex-direction:column;
  align-items:center; gap: clamp(4px, 0.8vw, 10px);
  padding: clamp(8px, 1.5vw, 18px) clamp(4px, 0.8vw, 12px);
  border-radius: var(--radius-sm);
  cursor:pointer;
  transition: background 0.2s;
  text-align:center;
  border: 1px solid transparent;
}
.file-item:hover {
  background: rgba(255,255,255,0.06);
  border-color: var(--border);
}
.file-item.selected {
  background: rgba(0,212,255,0.1);
  border-color: rgba(0,212,255,0.3);
}
.file-icon { font-size: clamp(1.5rem, 3vw, 3rem); }
.file-name {
  font-size: clamp(0.6rem, 1vw, 0.85rem); color: var(--text);
  line-height:1.3;
  word-break:break-word;
}

.explorer-detail {
  width: 0;
  border-left: 1px solid var(--border);
  padding: 0;
  overflow:hidden;
  background: rgba(0,0,0,0.1);
  display:flex;
  flex-direction:column; gap:0.8rem;
  transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1), padding 0.3s ease;
  opacity:0;
}
.explorer-detail.open {
  width: clamp(220px, 30vw, 350px);
  padding: clamp(0.8rem, 1.5vw, 1.5rem);
  overflow:auto;
  opacity:1;
  transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1), padding 0.3s ease, opacity 0.2s 0.1s ease;
}
.detail-header {
  display:flex; align-items:center; gap: clamp(6px, 1vw, 12px);
}
.detail-icon { font-size: clamp(1.5rem, 2.5vw, 2.5rem); }
.detail-title { font-size: clamp(0.85rem, 1.3vw, 1.2rem); font-weight:600; color: var(--text-bright); }
.detail-meta {
  font-size: clamp(0.65rem, 0.9vw, 0.8rem); color: var(--text-muted);
  display:flex; flex-direction:column; gap:4px;
  padding: clamp(0.4rem, 0.8vw, 0.8rem) 0;
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.detail-desc {
  font-size: clamp(0.7rem, 1vw, 0.9rem); color: var(--text);
  line-height:1.6;
}
.detail-tags {
  display:flex; flex-wrap:wrap; gap: clamp(4px, 0.6vw, 8px);
}
.detail-tag {
  padding: clamp(2px, 0.4vw, 4px) clamp(6px, 1vw, 12px);
  border-radius:12px;
  background: rgba(0,212,255,0.1);
  color: var(--primary);
  font-size: clamp(0.6rem, 0.85vw, 0.75rem);
}

/* ============================================
   WINDOW: SCOLARITÃ‰ (File Explorer Tree)
   ============================================ */
.scolaire-container { display:flex; height:100%; }
.scolaire-tree {
  width: clamp(180px, 22vw, 240px);
  background: rgba(0,0,0,0.25);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  padding: 8px 0;
  flex-shrink: 0;
}
.tree-node {
  user-select: none;
}
.tree-node-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 12px 5px calc(12px + var(--tree-depth, 0) * 16px);
  font-size: 0.78rem;
  color: var(--text);
  cursor: pointer;
  transition: background 0.15s;
  border-radius: 0;
}
.tree-node-header:hover { background: rgba(255,255,255,0.06); }
.tree-node-header.active {
  background: rgba(0,212,255,0.1);
  color: var(--primary);
}
.tree-chevron {
  font-size: 0.6rem;
  color: var(--text-muted);
  transition: transform 0.2s;
  width: 12px;
  text-align: center;
  flex-shrink: 0;
}
.tree-chevron.open { transform: rotate(90deg); }
.tree-chevron.empty { visibility: hidden; }
.tree-node-icon { font-size: 1rem; flex-shrink: 0; }
.tree-node-label { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tree-children {
  overflow: hidden;
  max-height: 0;
  transition: max-height 0.3s ease;
}
.tree-children.open {
  max-height: 500px;
}
.scolaire-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.scolaire-toolbar {
  display: flex;
  align-items: center;
  padding: 6px 12px;
  background: rgba(0,0,0,0.15);
  border-bottom: 1px solid var(--border);
  gap: 8px;
}
.scolaire-path {
  font-size: 0.75rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 4px;
}
.scolaire-path span {
  color: var(--text);
  cursor: pointer;
  transition: color 0.15s;
}
.scolaire-path span:hover { color: var(--primary); }
.scolaire-path-sep { color: var(--text-muted); font-size: 0.7rem; }
.scolaire-grid {
  flex: 1;
  padding: clamp(0.8rem, 1.5vw, 1.5rem);
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(clamp(90px, 12vw, 140px), 1fr));
  gap: clamp(8px, 1vw, 14px);
  align-content: start;
  overflow-y: auto;
}
.scolaire-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 14px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s;
  text-align: center;
  border: 1px solid transparent;
}
.scolaire-item:hover {
  background: rgba(255,255,255,0.06);
  border-color: var(--border);
}
.scolaire-item.selected {
  background: rgba(0,212,255,0.1);
  border-color: rgba(0,212,255,0.3);
}
.scolaire-item-icon { font-size: 2.5rem; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3)); }
.scolaire-item-name {
  font-size: 0.75rem;
  color: var(--text);
  line-height: 1.3;
  word-break: break-word;
}
.scolaire-item-meta {
  font-size: 0.62rem;
  color: var(--text-muted);
}
.scolaire-empty {
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.8rem;
  padding: 3rem;
  color: var(--text-muted);
  font-size: 0.85rem;
}
.scolaire-empty-icon { font-size: 3rem; opacity: 0.4; }
.scolaire-detail {
  width: 0;
  border-left: 1px solid var(--border);
  padding: 0;
  overflow: hidden;
  background: rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1), padding 0.3s ease;
  opacity: 0;
}
.scolaire-detail.open {
  width: clamp(220px, 28vw, 320px);
  padding: clamp(0.8rem, 1.5vw, 1.5rem);
  overflow-y: auto;
  opacity: 1;
  transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1), padding 0.3s ease, opacity 0.2s 0.1s ease;
}
.scolaire-detail-header {
  display: flex;
  align-items: center;
  gap: 10px;
}
.scolaire-detail-icon { font-size: 2rem; }
.scolaire-detail-title { font-size: 1rem; font-weight: 600; color: var(--text-bright); }
.scolaire-detail-meta {
  font-size: 0.75rem;
  color: var(--text-muted);
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 0.6rem 0;
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.scolaire-detail-desc {
  font-size: 0.82rem;
  color: var(--text);
  line-height: 1.6;
}
.scolaire-detail-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.scolaire-detail-tag {
  padding: 3px 10px;
  border-radius: 12px;
  background: rgba(0,212,255,0.1);
  color: var(--primary);
  font-size: 0.7rem;
}
.scolaire-statusbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 12px;
  background: rgba(0,0,0,0.2);
  border-top: 1px solid var(--border);
  font-size: 0.68rem;
  color: var(--text-muted);
}

/* Bouton Ouvrir dans le dÃ©tail */
.scolaire-open-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 0.8rem;
  padding: 8px 20px;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: var(--bg-dark);
  border: none;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.8rem;
  cursor: pointer;
  font-family: var(--font);
  transition: transform 0.2s, box-shadow 0.2s;
  width: 100%;
}
.scolaire-open-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0,212,255,0.3);
}

/* Document viewer (iframe PDF) */
.doc-viewer {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.doc-viewer-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 14px;
  background: rgba(0,0,0,0.25);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  gap: 8px;
}
.doc-viewer-title {
  font-size: 0.78rem;
  color: var(--text-muted);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}
.doc-viewer-actions {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
}
.doc-viewer-btn {
  padding: 5px 14px;
  background: rgba(255,255,255,0.06);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 4px;
  font-size: 0.75rem;
  cursor: pointer;
  font-family: var(--font);
  transition: background 0.2s;
  display: flex;
  align-items: center;
  gap: 4px;
}
.doc-viewer-btn:hover { background: rgba(255,255,255,0.1); }
.doc-viewer-btn.primary {
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: var(--bg-dark);
  border: none;
  font-weight: 600;
}
.doc-viewer-btn.primary:hover {
  box-shadow: 0 4px 16px rgba(0,212,255,0.3);
}
.doc-viewer-frame {
  flex: 1;
  border: none;
  background: rgba(0,0,0,0.1);
  min-height: 0;
}
.doc-viewer-fallback {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 2rem;
  color: var(--text-muted);
  text-align: center;
}
.doc-viewer-fallback-icon { font-size: 3.5rem; opacity: 0.5; }
.doc-viewer-fallback-title { font-size: 1rem; color: var(--text-bright); font-weight: 600; }
.doc-viewer-fallback-text { font-size: 0.82rem; line-height: 1.5; max-width: 350px; }

/* ============================================
   WINDOW: CONTACT (Outlook-style Mail App)
   ============================================ */
.mail-container { display:flex; height:100%; }
.mail-sidebar-left {
  width:200px;
  background: rgba(0,0,0,0.25);
  border-right: 1px solid var(--border);
  padding:0;
  display:flex; flex-direction:column;
}
.mail-sidebar-header {
  padding: 12px 14px;
  border-bottom: 1px solid var(--border);
  display:flex; align-items:center; gap:8px;
  font-size:0.85rem; font-weight:600;
  color: var(--text-bright);
}
.mail-compose-btn {
  margin: 10px 12px;
  padding: 9px 16px;
  background: var(--primary);
  color: var(--bg-dark);
  border:none; border-radius: 6px;
  font-weight:600; font-size:0.8rem;
  cursor:pointer;
  font-family: var(--font);
  transition: background 0.2s;
  display:flex; align-items:center; gap:6px;
}
.mail-compose-btn:hover { background: var(--primary-dark); }
.mail-folders {
  padding: 4px 8px;
  display:flex; flex-direction:column; gap:2px;
  flex:1;
}
.mail-folder {
  padding: 7px 12px;
  border-radius: 6px;
  font-size:0.78rem;
  color: var(--text-muted);
  cursor:pointer;
  display:flex; align-items:center; gap:8px;
  transition: background 0.2s;
}
.mail-folder:hover { background: rgba(255,255,255,0.06); }
.mail-folder.active {
  background: rgba(0,120,212,0.2);
  color: #0078d4;
}
.mail-folder-badge {
  margin-left:auto;
  background: #0078d4;
  color: #fff;
  font-size:0.65rem;
  padding: 1px 6px;
  border-radius: 10px;
  font-weight:600;
}
.mail-sidebar-footer {
  padding: 10px 14px;
  border-top: 1px solid var(--border);
  display:flex; align-items:center; gap:8px;
  font-size:0.72rem;
  color: var(--text-muted);
}
.mail-sidebar-avatar {
  width:28px; height:28px; border-radius:50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  display:flex; align-items:center; justify-content:center;
  font-size:0.7rem; font-weight:700; color: var(--bg-dark);
}

/* Mail main area */
.mail-main { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.mail-toolbar {
  display:flex; align-items:center; gap:6px;
  padding: 8px 16px;
  border-bottom: 1px solid var(--border);
  background: rgba(0,0,0,0.1);
}
.mail-toolbar-btn {
  padding: 5px 12px;
  border:none; border-radius:4px;
  background: rgba(255,255,255,0.06);
  color: var(--text-muted);
  font-size:0.75rem;
  cursor:pointer;
  font-family: var(--font);
  display:flex; align-items:center; gap:4px;
  transition: background 0.2s, color 0.2s;
}
.mail-toolbar-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }
.mail-toolbar-sep { width:1px; height:20px; background: var(--border); margin: 0 4px; }

/* Compose area */
.mail-compose-area {
  flex:1; padding: 0; overflow:auto;
  display:flex; flex-direction:column;
}
.mail-compose-fields {
  padding: 0 16px;
  display:flex; flex-direction:column;
}
.mail-field-row {
  display:flex; align-items:center;
  border-bottom: 1px solid var(--border);
  padding: 8px 0;
}
.mail-field-label {
  font-size:0.78rem; color: var(--text-muted);
  min-width: 50px; font-weight:500;
}
.mail-field-input {
  flex:1;
  background: transparent; border:none; outline:none;
  color: var(--text);
  font-family: var(--font); font-size:0.85rem;
  padding: 4px 8px;
}
.mail-field-input::placeholder { color: rgba(255,255,255,0.2); }
.mail-field-static {
  flex:1;
  font-size:0.82rem; color: var(--primary);
  padding: 4px 8px;
}
.mail-body-area {
  flex:1; padding: 16px;
  display:flex; flex-direction:column;
}
.mail-body-textarea {
  flex:1;
  background: transparent; border:none; outline:none;
  color: var(--text);
  font-family: var(--font); font-size:0.85rem;
  resize:none;
  line-height: 1.7;
  min-height: 150px;
}
.mail-body-textarea::placeholder { color: rgba(255,255,255,0.2); }

/* Status bar */
.mail-statusbar {
  display:flex; align-items:center; justify-content:space-between;
  padding: 6px 16px;
  border-top: 1px solid var(--border);
  background: rgba(0,0,0,0.1);
  font-size:0.7rem; color: var(--text-muted);
}
.mail-send-btn {
  padding: 7px 22px;
  background: #0078d4;
  color: #fff;
  border:none; border-radius: 4px;
  font-weight:600; font-size:0.8rem;
  cursor:pointer;
  font-family: var(--font);
  display:flex; align-items:center; gap:6px;
  transition: background 0.2s, transform 0.15s;
}
.mail-send-btn:hover { background: #106ebe; transform: translateY(-1px); }
.mail-send-btn:disabled {
  background: #555; cursor:not-allowed; transform:none;
}
.mail-send-btn.sending {
  background: var(--accent-green);
}

/* Sent confirmation overlay */
.mail-sent-overlay {
  position:absolute; inset:0;
  background: rgba(10,14,39,0.92);
  display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:1rem;
  z-index:10;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
.mail-sent-icon { font-size:3rem; }
.mail-sent-title { font-size:1.1rem; font-weight:600; color: var(--accent-green); }
.mail-sent-sub { font-size:0.8rem; color: var(--text-muted); }

/* Sent items list */
.mail-list {
  flex:1; overflow:auto; padding:0;
  display:flex; flex-direction:column;
}
.mail-list-empty {
  flex:1; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:0.8rem;
  color: var(--text-muted); font-size:0.85rem;
}
.mail-list-empty-icon { font-size:2.5rem; opacity:0.4; }
.mail-list-item {
  display:flex; align-items:flex-start; gap:10px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  cursor:pointer;
  transition: background 0.15s;
}
.mail-list-item:hover { background: rgba(255,255,255,0.04); }
.mail-list-item.selected { background: rgba(0,120,212,0.15); }
.mail-list-avatar {
  width:32px; height:32px; border-radius:50%; flex-shrink:0;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  display:flex; align-items:center; justify-content:center;
  font-size:0.7rem; font-weight:700; color: var(--bg-dark);
}
.mail-list-content { flex:1; min-width:0; }
.mail-list-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:2px;
}
.mail-list-sender {
  font-size:0.8rem; font-weight:600; color: var(--text-bright);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.mail-list-time {
  font-size:0.65rem; color: var(--text-muted); flex-shrink:0; margin-left:8px;
}
.mail-list-subject {
  font-size:0.75rem; color: var(--text); margin-bottom:2px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.mail-list-preview {
  font-size:0.7rem; color: var(--text-muted);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Mail read view */
.mail-read-view {
  flex:1; overflow:auto; padding:20px;
  display:flex; flex-direction:column; gap:16px;
}
.mail-read-header {
  display:flex; flex-direction:column; gap:8px;
  padding-bottom:12px; border-bottom:1px solid var(--border);
}
.mail-read-subject { font-size:1.1rem; font-weight:600; color:var(--text-bright); }
.mail-read-meta { font-size:0.78rem; color:var(--text-muted); display:flex; flex-direction:column; gap:4px; }
.mail-read-body {
  font-size:0.85rem; color:var(--text); line-height:1.7;
  white-space:pre-wrap;
}

/* Contact links footer */
.contact-links {
  display:flex; gap:12px;
  flex-wrap: wrap;
}
.contact-link {
  display:flex; align-items:center; gap:8px;
  padding: 10px 18px;
  border-radius: var(--radius-sm);
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--border);
  color: var(--text);
  font-size:0.8rem;
  text-decoration:none;
  cursor:pointer;
  transition: border-color 0.2s, transform 0.2s;
}
.contact-link:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}
.contact-link-icon { font-size:1.1rem; }

/* ============================================
   WINDOW: PROJETS (Tableau de bord)
   ============================================ */
.projets-container {
  height:100%; display:flex; flex-direction:column;
}
.projets-tabs {
  display:flex;
  background: rgba(0,0,0,0.2);
  border-bottom: 1px solid var(--border);
  padding: 0 8px;
  gap:0;
}
.projets-tab {
  padding: 10px 20px;
  font-size:0.8rem;
  color: var(--text-muted);
  cursor:pointer;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-color 0.2s, background 0.2s;
  display:flex; align-items:center; gap:6px;
  font-family: var(--font);
  background:transparent;
  border-top:none; border-left:none; border-right:none;
}
.projets-tab:hover { color: var(--text); background: rgba(255,255,255,0.04); }
.projets-tab.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
  background: rgba(0,212,255,0.05);
}
.projets-tab-count {
  font-size:0.65rem;
  background: rgba(255,255,255,0.1);
  padding: 1px 7px;
  border-radius:10px;
  color: var(--text-muted);
}

.projets-panel {
  flex:1; overflow:auto;
  display:none;
  padding: 1.2rem;
}
.projets-panel.active { display:block; }

.projets-category {
  margin-bottom: 1.5rem;
}
.projets-category-header {
  display:flex; align-items:center; gap:8px;
  margin-bottom: 0.8rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border);
}
.projets-category-icon { font-size:1.1rem; }
.projets-category-title {
  font-size:0.82rem; font-weight:600;
  color: var(--text-bright);
}
.projets-category-count {
  font-size:0.68rem;
  color: var(--text-muted);
  margin-left:auto;
}

.projet-card {
  display:flex; gap:14px;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.02);
  margin-bottom: 8px;
  cursor:pointer;
  transition: border-color 0.2s, background 0.2s, transform 0.15s;
  position:relative;
  overflow:hidden;
}
.projet-card:hover {
  border-color: rgba(0,212,255,0.3);
  background: rgba(0,212,255,0.04);
  transform: translateX(4px);
}
.projet-card-icon {
  font-size:1.8rem;
  min-width:40px;
  display:flex; align-items:flex-start; justify-content:center;
  padding-top:2px;
}
.projet-card-body { flex:1; min-width:0; }
.projet-card-title {
  font-size:0.85rem; font-weight:600;
  color: var(--text-bright);
  margin-bottom:3px;
  display:flex; align-items:center; gap:8px;
}
.projet-card-context {
  font-size:0.68rem;
  padding: 2px 8px;
  border-radius: 10px;
  font-weight:500;
}
.projet-card-context.ecole {
  background: rgba(187,134,252,0.15);
  color: var(--accent-purple);
}
.projet-card-context.entreprise {
  background: rgba(0,212,255,0.15);
  color: var(--primary);
}
.projet-card-context.perso {
  background: rgba(0,230,118,0.15);
  color: var(--accent-green);
}
.projet-card-desc {
  font-size:0.75rem;
  color: var(--text-muted);
  line-height:1.5;
  margin-bottom:6px;
}
.projet-card-footer {
  display:flex; align-items:center; gap:6px;
  flex-wrap:wrap;
}
.projet-card-tag {
  font-size:0.65rem;
  padding: 2px 8px;
  border-radius:8px;
  background: rgba(255,255,255,0.06);
  color: var(--text-muted);
  border: 1px solid rgba(255,255,255,0.06);
}
.projet-card-date {
  font-size:0.65rem;
  color: var(--text-muted);
  margin-left:auto;
  opacity:0.7;
}

.projet-card-status {
  position:absolute;
  top:0; right:0;
  width:8px; height:8px;
  border-radius:50%;
  margin:12px;
}
.projet-card-status.done { background: var(--accent-green); }
.projet-card-status.progress { background: var(--accent-yellow); }
.projet-card-status.planned { background: var(--text-muted); }

.projets-legend {
  display:flex; gap:16px;
  padding: 8px 14px;
  background: rgba(0,0,0,0.15);
  border-top: 1px solid var(--border);
  font-size:0.68rem;
  color: var(--text-muted);
}
.projets-legend-item {
  display:flex; align-items:center; gap:5px;
}
.projets-legend-dot {
  width:6px; height:6px;
  border-radius:50%;
}

/* ============================================
   TERMINAL WINDOW
   ============================================ */
.terminal-container {
  height:100%;
  background: #0c0c0c;
  padding:0;
  display:flex; flex-direction:column;
}
.terminal-header-bar {
  display:flex; align-items:center; gap:8px;
  padding: 6px 12px;
  background: rgba(255,255,255,0.03);
  border-bottom: 1px solid var(--border);
}
.terminal-tab-item {
  font-size:0.72rem;
  color: var(--text-muted);
  padding: 4px 10px;
  border-radius: 4px;
  cursor:pointer;
}
.terminal-tab-item.active {
  background: rgba(255,255,255,0.08);
  color: var(--text);
}

.terminal-output {
  flex:1;
  overflow:auto;
  padding: 12px;
  font-family: var(--font-mono);
  font-size: 0.82rem;
  line-height: 1.6;
  color: var(--accent-green);
}
.terminal-output .t-prompt { color: var(--primary); }
.terminal-output .t-cmd { color: var(--text-bright); }
.terminal-output .t-result { color: var(--text); }
.terminal-output .t-error { color: var(--accent-red); }
.terminal-output .t-warn { color: var(--accent-yellow); }
.terminal-output .t-info { color: var(--primary); }

.terminal-input-line {
  display:flex; align-items:center;
  padding: 6px 12px;
  border-top: 1px solid var(--border);
  background: rgba(0,0,0,0.3);
  gap:8px;
}
.terminal-prompt-text {
  font-family: var(--font-mono);
  font-size:0.82rem;
  color: var(--primary);
  white-space:nowrap;
}
.terminal-input {
  flex:1;
  background:transparent;
  border:none; outline:none;
  color: var(--text-bright);
  font-family: var(--font-mono);
  font-size:0.82rem;
}

/* ============================================
   GLITCH / AUTODESTRUCTION
   ============================================ */
.glitch-overlay {
  position:fixed; inset:0;
  z-index: var(--z-glitch);
  pointer-events:none;
  opacity:0;
  transition: opacity 0.3s;
}
.glitch-overlay.active {
  opacity:1;
  animation: glitchFlicker 0.15s infinite;
}
@keyframes glitchFlicker {
  0% { background: transparent; }
  20% { background: rgba(255,0,0,0.08); }
  40% { background: rgba(0,255,0,0.05); }
  60% { background: rgba(0,0,255,0.08); }
  80% { background: rgba(255,0,0,0.05); }
  100% { background: transparent; }
}

.glitch-text {
  position:fixed;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  z-index: var(--z-glitch-text);
  font-family: var(--font-mono);
  font-size: clamp(1.5rem, 4vw, 3rem);
  font-weight:700;
  color: var(--accent-red);
  text-shadow:
    2px 0 var(--primary),
    -2px 0 var(--accent-green);
  display:none;
  text-align:center;
  line-height:1.4;
  animation: glitchText 0.3s infinite;
}
.glitch-text.active { display:block; }
@keyframes glitchText {
  0% { transform: translate(-50%,-50%) skew(0); }
  20% { transform: translate(-52%,-48%) skew(2deg); }
  40% { transform: translate(-48%,-52%) skew(-1deg); }
  60% { transform: translate(-51%,-49%) skew(1deg); }
  80% { transform: translate(-49%,-51%) skew(-2deg); }
  100% { transform: translate(-50%,-50%) skew(0); }
}

.fire-particles {
  position:fixed; inset:0;
  z-index: var(--z-fire);
  pointer-events:none;
  overflow:hidden;
}
.fire-particle {
  position:absolute;
  width:6px; height:6px;
  border-radius:50%;
  animation: fireRise 1.5s ease-out forwards;
}
@keyframes fireRise {
  0% { opacity:1; transform: translateY(0) scale(1); }
  100% { opacity:0; transform: translateY(-200px) scale(0); }
}

/* ============================================
   NOTIFICATIONS
   ============================================ */
.notification {
  position:fixed;
  bottom: calc(var(--taskbar-h) + 16px);
  right: 16px;
  background: var(--bg-taskbar);
  backdrop-filter: blur(30px);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 20px 10px;
  z-index: var(--z-notification);
  box-shadow: var(--shadow);
  display:flex; flex-direction: column; gap:8px;
  transform: translateX(120%);
  transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  max-width: 350px;
  overflow:hidden;
  cursor:pointer;
}
.notification.show { transform: translateX(0); }
.notification-content {
  display:flex; align-items:center; gap:12px;
}
.notification-icon { font-size:1.3rem; }
.notification-body { display:flex; flex-direction:column; gap:2px; }
.notification-title { font-size:0.8rem; font-weight:600; color: var(--text-bright); }
.notification-text { font-size:0.72rem; color: var(--text-muted); }
.notification-progress {
  width:100%; height:2px;
  background: rgba(255,255,255,0.08);
  border-radius:1px;
  margin-top:2px;
}
.notification-progress-fill {
  height:100%;
  background: var(--primary);
  border-radius:1px;
  width:100%;
  transition: width linear;
}

/* ============================================
   WINDOW: CV VIEWER
   ============================================ */
.cv-viewer { height:100%; display:flex; flex-direction:column; overflow:hidden; }
.cv-toolbar {
  display:flex; align-items:center; justify-content:space-between;
  padding: 8px 14px;
  background: rgba(0,0,0,0.25);
  border-bottom: 1px solid var(--border);
  flex-shrink:0;
}
.cv-toolbar-title { font-size:0.78rem; color: var(--text-muted); }
.cv-download-btn {
  padding: 6px 16px;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: var(--bg-dark);
  border:none; border-radius: 20px;
  font-weight:600; font-size:0.78rem;
  cursor:pointer;
  font-family: var(--font);
  transition: transform 0.2s, box-shadow 0.2s;
}
.cv-download-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0,212,255,0.3);
}
.cv-content {
  flex:1; overflow-y:auto; overflow-x:hidden;
  padding: 1.5rem;
  display:flex; justify-content:center; align-items:flex-start;
  background: rgba(0,0,0,0.1);
  min-height:0;
}
.cv-page {
  background: #1a1a2e;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 2rem;
  max-width: 600px;
  width:100%;
  box-shadow: 0 4px 24px rgba(0,0,0,0.4);
  flex-shrink:0;
}
.cv-header-section {
  display:flex; align-items:center; gap:1.2rem;
  margin-bottom:1.5rem;
  padding-bottom:1.2rem;
  border-bottom: 2px solid var(--primary);
}
.cv-avatar-big {
  width:64px; height:64px; border-radius:50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  display:flex; align-items:center; justify-content:center;
  font-size:1.5rem; font-weight:700; color: var(--bg-dark);
  flex-shrink:0;
}
.cv-header-info { flex:1; }
.cv-name { font-size:1.4rem; font-weight:700; color: var(--text-bright); margin-bottom:2px; }
.cv-subtitle { font-size:0.85rem; color: var(--primary); font-weight:500; margin-bottom:6px; }
.cv-contact-row { display:flex; flex-wrap:wrap; gap:12px; font-size:0.72rem; color: var(--text-muted); }
.cv-section { margin-bottom:1.2rem; }
.cv-section-title {
  font-size:0.85rem; font-weight:700; color: var(--primary);
  margin-bottom:0.6rem; padding-bottom:4px;
  border-bottom: 1px solid rgba(0,212,255,0.15);
}
.cv-entry { margin-bottom:0.8rem; }
.cv-entry-header { display:flex; justify-content:space-between; align-items:baseline; flex-wrap:wrap; gap:4px; }
.cv-entry-header strong { font-size:0.82rem; color: var(--text-bright); }
.cv-entry-date { font-size:0.7rem; color: var(--text-muted); }
.cv-entry-sub { font-size:0.75rem; color: var(--text-muted); margin-top:2px; }
.cv-entry-list {
  margin: 6px 0 0 1.2rem;
  font-size:0.75rem; color: var(--text);
  line-height:1.7;
}
.cv-entry-list li::marker { color: var(--primary); }
.cv-skills-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.cv-skill-cat { padding:8px; border-radius: var(--radius-sm); background: rgba(255,255,255,0.03); border: 1px solid var(--border); }
.cv-skill-cat-title { font-size:0.72rem; font-weight:600; color: var(--text-bright); margin-bottom:6px; }
.cv-skill-tags { display:flex; flex-wrap:wrap; gap:4px; }
.cv-skill-tags span {
  padding: 2px 8px; border-radius:10px;
  background: rgba(0,212,255,0.1); color: var(--primary);
  font-size:0.62rem; font-weight:500;
}
.cv-objective {
  font-size:0.78rem; color: var(--text); line-height:1.6;
  font-style:italic;
}

/* ============================================
   CONTEXT MENU
   ============================================ */
.context-menu {
  position:fixed;
  background: var(--bg-taskbar);
  backdrop-filter: blur(30px);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 4px 0;
  z-index: var(--z-context);
  min-width: 200px;
  box-shadow: var(--shadow);
  display:none;
}
.context-menu.visible { display:block; }
.context-menu-item {
  padding: 7px 16px;
  font-size:0.78rem;
  color: var(--text);
  cursor:pointer;
  display:flex; align-items:center; gap:10px;
  transition: background 0.15s;
}
.context-menu-item:hover { background: rgba(0,212,255,0.1); }
.context-menu-separator {
  height:1px;
  background: var(--border);
  margin: 4px 8px;
}

/* Context menu submenus */
.context-menu-submenu {
  position: relative;
}
.context-menu-submenu > .context-menu-label {
  padding: 7px 16px;
  font-size: 0.78rem;
  color: var(--text);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.15s;
  justify-content: space-between;
}
.context-menu-submenu > .context-menu-label:hover {
  background: rgba(0,212,255,0.1);
}
.context-menu-submenu > .context-menu-label::after {
  content: 'â–¸';
  font-size: 0.7rem;
  color: var(--text-muted);
}
.context-submenu {
  position: absolute;
  left: 100%;
  top: -4px;
  background: var(--bg-taskbar);
  backdrop-filter: blur(30px);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 4px 0;
  min-width: 200px;
  box-shadow: var(--shadow);
  display: none;
}
.context-menu-submenu:hover > .context-submenu {
  display: block;
}
.context-menu.flip-submenu .context-submenu {
  left: auto;
  right: 100%;
}
.color-swatch {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid transparent;
  flex-shrink: 0;
}
.color-swatch.active {
  border-color: var(--text-bright);
  box-shadow: 0 0 6px rgba(255,255,255,0.3);
}

/* Desktop wallpaper variants */
#desktop.wallpaper-nebula {
  background: linear-gradient(135deg, #1a0533 0%, #2d1b69 30%, #1a0533 60%, #3d1f8e 100%);
}
#desktop.wallpaper-matrix {
  background: linear-gradient(160deg, #011a01 0%, #0a2e0a 30%, #011a01 60%, #0d3d0d 100%);
}
#desktop.wallpaper-sunset {
  background: linear-gradient(160deg, #1a0a00 0%, #3d1a0a 30%, #1a0f05 60%, #4d2510 100%);
}
#desktop.wallpaper-ocean {
  background: linear-gradient(160deg, #001020 0%, #002040 30%, #001830 60%, #003060 100%);
}
#desktop.wallpaper-minimal {
  background: linear-gradient(160deg, #111 0%, #1a1a1a 30%, #111 60%, #222 100%);
}

/* ============================================
   RESPONSIVE / MOBILE
   ============================================ */
#mobileMessage { display:none !important; }

/* Use dynamic viewport height for mobile browsers */
@supports (height: 100dvh) {
  html, body { height: 100dvh; }
  #lockScreen, #desktop { height: 100dvh; }
}

@media (max-width: 768px) {
  :root {
    --taskbar-h: 48px;
  }

  /* â”€â”€ Lock Screen mobile â”€â”€ */
  .lock-avatar { width:80px; height:80px; font-size:2rem; }
  .lock-input { width:160px; font-size:0.85rem; padding:0.6rem 1rem; }
  .lock-btn { padding:0.6rem 1.2rem; font-size:0.8rem; }
  .lock-input-wrapper { flex-wrap:nowrap; }

  /* â”€â”€ Desktop icons â”€â”€ */
  .desktop-icons {
    top:12px; left:8px; right:8px;
    flex-direction:row; flex-wrap:wrap;
    gap:4px;
  }
  .desktop-icon {
    width:72px;
    padding:8px 4px;
  }
  .desktop-icon-img { width:40px; height:40px; font-size:1.6rem; }
  .desktop-icon-label { font-size:0.65rem; }

  /* â”€â”€ Taskbar mobile â”€â”€ */
  #taskbar { padding:0 6px; }
  .taskbar-center {
    position:relative; left:auto; transform:none;
    flex:1;
    overflow-x:auto;
    overflow-y:hidden;
    -webkit-overflow-scrolling:touch;
    scrollbar-width:none;
    gap:0;
    justify-content:center;
  }
  .taskbar-center::-webkit-scrollbar { display:none; }
  .taskbar-btn { min-width:38px; height:36px; padding:0 6px; font-size:1rem; }
  .taskbar-tray { display:none; }
  .taskbar-clock { padding:2px 4px; }
  .taskbar-time { font-size:0.72rem; }
  .taskbar-date-small { font-size:0.6rem; }

  /* â”€â”€ Start menu mobile â”€â”€ */
  #startMenu {
    width: calc(100vw - 16px);
    max-height: 70vh;
    overflow-y:auto;
    padding:1rem;
    bottom: calc(var(--taskbar-h) + 8px);
  }
  .start-apps {
    grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
    gap:4px;
  }
  .start-app { padding:10px 4px; }
  .start-app-icon { font-size:1.4rem; }
  .start-app-label { font-size:0.65rem; }

  /* â”€â”€ Windows: always maximized on mobile â”€â”€ */
  .os-window {
    position:fixed !important;
    top:0 !important; left:0 !important;
    width:100vw !important;
    height: calc(100vh - var(--taskbar-h)) !important;
    height: calc(100dvh - var(--taskbar-h)) !important;
    min-width:0 !important;
    min-height:0 !important;
    border-radius:0 !important;
    border:none !important;
  }
  .resize-handle { display:none !important; }
  .window-ctrl-btn.maximize-btn { display:none; }

  /* â”€â”€ Window title bar compact â”€â”€ */
  .window-titlebar { height:34px; min-height:34px; padding:0 8px; gap:6px; }
  .window-titlebar-text { font-size:0.72rem; }
  .window-ctrl-btn { width:32px; height:28px; }

  /* â”€â”€ Accueil content mobile â”€â”€ */
  .accueil-content { padding:1.2rem 1rem; }
  .accueil-greeting { font-size:0.75rem; letter-spacing:1px; }
  .terminal-text { font-size:0.72rem; padding:0.8rem 1rem; min-height:60px; }
  .accueil-tags { gap:6px; }
  .accueil-tag { padding:4px 10px; font-size:0.68rem; }

  /* â”€â”€ Ã€ propos editor mobile â”€â”€ */
  .editor-sidebar { width:36px; padding-top:6px; gap:10px; }
  .editor-sidebar-icon { width:24px; height:24px; font-size:0.75rem; }
  .editor-tabs { overflow-x:auto; scrollbar-width:none; flex-wrap:nowrap; }
  .editor-tabs::-webkit-scrollbar { display:none; }
  .editor-tab { padding:6px 10px; font-size:0.68rem; white-space:nowrap; }
  .editor-code { font-size:0.7rem; padding:0.6rem; line-height:1.6; }
  .code-line { gap:0.5rem; }
  .code-line::before { min-width:2em; font-size:0.65rem; }

  /* â”€â”€ RÃ©alisations explorer mobile â”€â”€ */
  .explorer-content { flex-direction:column; }
  .explorer-files {
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap:6px;
    padding:0.6rem;
  }
  .file-item { padding:10px 6px; }
  .file-icon { font-size:1.8rem; }
  .file-name { font-size:0.65rem; }
  .explorer-detail.open {
    width:100% !important;
    border-left:none;
    border-top:1px solid var(--border);
    padding:1rem;
    max-height:45%;
  }

  /* â”€â”€ ScolaritÃ© explorer mobile â”€â”€ */
  .scolaire-container { flex-direction:column; }
  .scolaire-tree { width:100%; max-height:120px; border-right:none; border-bottom:1px solid var(--border); }
  .scolaire-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap:6px; padding:0.6rem; }
  .scolaire-item { padding:10px 6px; }
  .scolaire-item-icon { font-size:1.8rem; }
  .scolaire-item-name { font-size:0.65rem; }
  .scolaire-detail.open {
    width:100% !important;
    border-left:none;
    border-top:1px solid var(--border);
    padding:1rem;
    max-height:40%;
  }

  /* â”€â”€ Contact mail mobile â”€â”€ */
  .mail-container { flex-direction:column; }
  .mail-sidebar-left {
    width:100%; flex-direction:row; flex-wrap:wrap;
    padding:0; gap:0;
    border-right:none; border-bottom:1px solid var(--border);
  }
  .mail-sidebar-header { display:none; }
  .mail-sidebar-footer { display:none; }
  .mail-folders {
    flex-direction:row; flex-wrap:wrap;
    padding:6px 8px; gap:2px;
  }
  .mail-compose-btn { margin:6px 8px; padding:6px 12px; font-size:0.75rem; }
  .mail-folder { padding:4px 8px; font-size:0.7rem; }
  .mail-folder-badge { display:none; }
  .mail-toolbar { flex-wrap:wrap; padding:6px 10px; gap:4px; }
  .mail-toolbar-btn { font-size:0.7rem; padding:4px 8px; }
  .mail-field-label { font-size:0.7rem; min-width:40px; }
  .mail-field-input { font-size:0.8rem; }
  .mail-body-textarea { font-size:0.8rem; min-height:100px; }
  .mail-statusbar { padding:6px 10px; }
  .mail-send-btn { padding:6px 16px; font-size:0.75rem; }
  .contact-links { gap:4px; }
  .contact-link { padding:5px 8px; font-size:0.68rem; }

  /* â”€â”€ Projets mobile â”€â”€ */
  .projets-tabs { overflow-x:auto; scrollbar-width:none; flex-wrap:nowrap; }
  .projets-tabs::-webkit-scrollbar { display:none; }
  .projets-tab { padding:8px 12px; font-size:0.72rem; white-space:nowrap; }
  .projet-card { flex-direction:column; gap:8px; padding:10px; }
  .projet-card-icon { min-width:auto; font-size:1.5rem; }
  .projet-card-title { font-size:0.78rem; flex-wrap:wrap; }
  .projet-card-desc { font-size:0.7rem; }
  .projet-card-footer { gap:4px; }
  .projet-card-tag { font-size:0.6rem; padding:2px 6px; }
  .projets-legend { font-size:0.62rem; gap:10px; padding:6px 10px; }

  /* â”€â”€ Terminal mobile â”€â”€ */
  .terminal-output { font-size:0.72rem; padding:8px; line-height:1.5; }
  .terminal-input-line { padding:4px 8px; gap:4px; }
  .terminal-prompt-text { font-size:0.72rem; }
  .terminal-input { font-size:0.72rem; }

  /* â”€â”€ Notifications mobile â”€â”€ */
  .notification { max-width:calc(100vw - 24px); right:12px; left:12px; }

  /* â”€â”€ Context menu mobile â”€â”€ */
  .context-menu { min-width:160px; }

  /* â”€â”€ Browser toolbar mobile â”€â”€ */
  .browser-toolbar { padding:4px 6px; gap:4px; }
  .browser-nav-btn { width:24px; height:24px; font-size:0.7rem; }
  .browser-url { font-size:0.68rem; padding:4px 8px; }

  /* â”€â”€ CV viewer mobile â”€â”€ */
  .cv-content { padding:0.8rem; }
  .cv-page { padding:1.2rem; }
  .cv-header-section { flex-direction:column; text-align:center; gap:0.8rem; }
  .cv-contact-row { justify-content:center; }
  .cv-name { font-size:1.1rem; }
  .cv-skills-grid { grid-template-columns:1fr; }
  .cv-toolbar { flex-direction:column; gap:6px; padding:6px 10px; }
  .cv-download-btn { width:100%; text-align:center; }
}

/* Small phones */
@media (max-width: 380px) {
  .desktop-icons { gap:2px; }
  .desktop-icon { width:60px; padding:6px 2px; }
  .desktop-icon-img { font-size:1.3rem; }
  .desktop-icon-label { font-size:0.6rem; }
  .lock-time { font-size:3.5rem; }
  .lock-avatar { width:64px; height:64px; font-size:1.5rem; }
  .lock-username { font-size:1rem; }
  .lock-input { width:130px; }
}
</style>
</head>
<body>

<!-- ========== NOSCRIPT ========== -->
<noscript>
  <div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0a0e27;color:#e0e0e0;font-family:sans-serif;text-align:center;padding:2rem;">
    <p>âš ï¸ Ce portfolio interactif nÃ©cessite JavaScript pour fonctionner.<br>Veuillez activer JavaScript dans votre navigateur.</p>
  </div>
</noscript>

<!-- ========== BOOT SCREEN ========== -->
<div id="bootScreen">
  <div class="boot-logo">ðŸ–¥ï¸</div>
  <div class="boot-text">AymenOS v2.0 â€” Initialisation...</div>
  <div class="boot-progress"><div class="boot-progress-fill"></div></div>
</div>

<!-- Mobile message hidden, site is now responsive -->

<!-- ========== LOCK SCREEN ========== -->
<div id="lockScreen" role="dialog" aria-label="Ã‰cran de verrouillage">
  <div class="lock-time" id="lockTime">00:00</div>
  <div class="lock-date" id="lockDate">Chargement...</div>
  <div class="lock-profile">
    <div class="lock-avatar">A</div>
    <div class="lock-username">Aymen Louraghi</div>
  </div>
  <div class="lock-action">
    <div class="lock-input-wrapper">
      <input type="password" class="lock-input" id="lockInput" placeholder="Mot de passe" autocomplete="off" aria-label="Mot de passe">
      <button class="lock-btn" id="unlockBtn">DÃ©verrouiller â†’</button>
    </div>
    <div class="lock-hint">Indice : 1234</div>
  </div>
</div>

<!-- ========== DESKTOP ========== -->
<div id="desktop">
  <!-- Particles -->
  <div class="particles" id="particles"></div>

  <!-- Desktop Icons -->
  <div class="desktop-icons">
    <div class="desktop-icon" data-window="accueil" ondblclick="openWindow('accueil')">
      <div class="desktop-icon-img">ðŸŒ</div>
      <div class="desktop-icon-label">Accueil.html</div>
    </div>
    <div class="desktop-icon" data-window="apropos" ondblclick="openWindow('apropos')">
      <div class="desktop-icon-img">ðŸ“</div>
      <div class="desktop-icon-label">Ã€_Propos.txt</div>
    </div>
    <div class="desktop-icon" data-window="realisations" ondblclick="openWindow('realisations')">
      <div class="desktop-icon-img">ðŸ“</div>
      <div class="desktop-icon-label">RÃ©alisations</div>
    </div>
    <div class="desktop-icon" data-window="projets" ondblclick="openWindow('projets')">
      <div class="desktop-icon-img">ðŸ“‚</div>
      <div class="desktop-icon-label">Projets</div>
    </div>
    <div class="desktop-icon" data-window="contact" ondblclick="openWindow('contact')">
      <div class="desktop-icon-img">ðŸ“¨</div>
      <div class="desktop-icon-label">Contact</div>
    </div>
    <div class="desktop-icon" data-window="terminal" ondblclick="openWindow('terminal')">
      <div class="desktop-icon-img">â¬›</div>
      <div class="desktop-icon-label">Terminal</div>
    </div>
    <div class="desktop-icon" data-window="scolarite" ondblclick="openWindow('scolarite')">
      <div class="desktop-icon-img">ðŸŽ“</div>
      <div class="desktop-icon-label">ScolaritÃ©</div>
    </div>
    <div class="desktop-icon" data-window="cv" ondblclick="openWindow('cv')">
      <div class="desktop-icon-img">ðŸ“„</div>
      <div class="desktop-icon-label">CV.pdf</div>
    </div>
  </div>
</div>

<!-- ========== TASKBAR ========== -->
<div id="taskbar">
  <div class="taskbar-left">
    <button class="taskbar-btn start-btn" id="startBtn" onclick="toggleStartMenu()" title="DÃ©marrer">âŠž</button>
  </div>
  <div class="taskbar-center" id="taskbarApps">
    <button class="taskbar-btn" onclick="openWindow('accueil')" title="Accueil">ðŸŒ</button>
    <button class="taskbar-btn" onclick="openWindow('apropos')" title="Ã€ Propos">ðŸ“</button>
    <button class="taskbar-btn" onclick="openWindow('realisations')" title="RÃ©alisations">ðŸ“</button>
    <button class="taskbar-btn" onclick="openWindow('projets')" title="Projets">ðŸ“‚</button>
    <button class="taskbar-btn" onclick="openWindow('contact')" title="Contact">ðŸ“¨</button>
    <button class="taskbar-btn" onclick="openWindow('terminal')" title="Terminal">â¬›</button>
    <button class="taskbar-btn" onclick="openWindow('scolarite')" title="ScolaritÃ©">ðŸŽ“</button>
    <button class="taskbar-btn" onclick="openWindow('cv')" title="CV">ðŸ“„</button>
    <button class="taskbar-btn" onclick="triggerSelfDestruct()" title="Autodestruction" style="color:var(--accent-red);">â˜¢ï¸</button>
  </div>
  <div class="taskbar-right">
    <div class="taskbar-tray">
      <span>ðŸ“¶</span>
      <span>ðŸ”Š</span>
    </div>
    <div class="taskbar-clock" id="taskbarClock">
      <span class="taskbar-time" id="taskbarTime">00:00</span>
      <span class="taskbar-date-small" id="taskbarDate">01/01</span>
    </div>
  </div>
</div>

<!-- ========== START MENU ========== -->
<div id="startMenu">
  <input type="text" class="start-search" placeholder="ðŸ” Rechercher dans le portfolio..." id="startSearch" autocomplete="off">
  <div class="start-section-title">APPLICATIONS</div>
  <div class="start-apps" id="startApps">
    <div class="start-app" onclick="openWindow('accueil'); toggleStartMenu();">
      <div class="start-app-icon">ðŸŒ</div>
      <div class="start-app-label">Accueil</div>
    </div>
    <div class="start-app" onclick="openWindow('apropos'); toggleStartMenu();">
      <div class="start-app-icon">ðŸ“</div>
      <div class="start-app-label">Ã€ Propos</div>
    </div>
    <div class="start-app" onclick="openWindow('realisations'); toggleStartMenu();">
      <div class="start-app-icon">ðŸ“</div>
      <div class="start-app-label">RÃ©alisations</div>
    </div>
    <div class="start-app" onclick="openWindow('projets'); toggleStartMenu();">
      <div class="start-app-icon">ðŸ“‚</div>
      <div class="start-app-label">Projets</div>
    </div>
    <div class="start-app" onclick="openWindow('contact'); toggleStartMenu();">
      <div class="start-app-icon">ðŸ“¨</div>
      <div class="start-app-label">Contact</div>
    </div>
    <div class="start-app" onclick="openWindow('terminal'); toggleStartMenu();">
      <div class="start-app-icon">â¬›</div>
      <div class="start-app-label">Terminal</div>
    </div>
    <div class="start-app" onclick="openWindow('scolarite'); toggleStartMenu();">
      <div class="start-app-icon">ðŸŽ“</div>
      <div class="start-app-label">ScolaritÃ©</div>
    </div>
    <div class="start-app" onclick="openWindow('cv'); toggleStartMenu();">
      <div class="start-app-icon">ðŸ“„</div>
      <div class="start-app-label">CV</div>
    </div>
    <div class="start-app" onclick="triggerSelfDestruct(); toggleStartMenu();">
      <div class="start-app-icon">â˜¢ï¸</div>
      <div class="start-app-label">Autodestruction</div>
    </div>
  </div>
  <div class="start-user">
    <div class="start-user-avatar">A</div>
    <div class="start-user-name">Aymen Louraghi</div>
  </div>
</div>

<!-- ========== CONTEXT MENU ========== -->
<div class="context-menu" id="contextMenu" role="menu">
  <div class="context-menu-item" role="menuitem" onclick="openWindow('accueil')">ðŸŒ  Ouvrir Accueil</div>
  <div class="context-menu-item" role="menuitem" onclick="openWindow('apropos')">ðŸ“  Ouvrir Ã€ Propos</div>
  <div class="context-menu-item" role="menuitem" onclick="openWindow('realisations')">ðŸ“  Ouvrir RÃ©alisations</div>
  <div class="context-menu-item" role="menuitem" onclick="openWindow('projets')">ðŸ“‚  Ouvrir Projets</div>
  <div class="context-menu-separator" role="separator"></div>
  <div class="context-menu-submenu">
    <div class="context-menu-label">ðŸ–¼ï¸  Fond d'Ã©cran</div>
    <div class="context-submenu" id="wallpaperSubmenu">
      <div class="context-menu-item" onclick="setWallpaper('default')"><span class="color-swatch" style="background:linear-gradient(135deg,#0a0e27,#0d1442);"></span> Cyber (dÃ©faut)</div>
      <div class="context-menu-item" onclick="setWallpaper('nebula')"><span class="color-swatch" style="background:linear-gradient(135deg,#1a0533,#3d1f8e);"></span> NÃ©buleuse</div>
      <div class="context-menu-item" onclick="setWallpaper('matrix')"><span class="color-swatch" style="background:linear-gradient(135deg,#011a01,#0d3d0d);"></span> Matrix</div>
      <div class="context-menu-item" onclick="setWallpaper('sunset')"><span class="color-swatch" style="background:linear-gradient(135deg,#1a0a00,#4d2510);"></span> CrÃ©puscule</div>
      <div class="context-menu-item" onclick="setWallpaper('ocean')"><span class="color-swatch" style="background:linear-gradient(135deg,#001020,#003060);"></span> OcÃ©an</div>
      <div class="context-menu-item" onclick="setWallpaper('minimal')"><span class="color-swatch" style="background:linear-gradient(135deg,#111,#222);"></span> Minimal</div>
    </div>
  </div>
  <div class="context-menu-submenu">
    <div class="context-menu-label">ðŸŽ¨  Couleur d'accent</div>
    <div class="context-submenu" id="accentSubmenu">
      <div class="context-menu-item" onclick="setAccentColor('cyan')"><span class="color-swatch" style="background:#00d4ff;"></span> Cyan (dÃ©faut)</div>
      <div class="context-menu-item" onclick="setAccentColor('green')"><span class="color-swatch" style="background:#00e676;"></span> Vert</div>
      <div class="context-menu-item" onclick="setAccentColor('purple')"><span class="color-swatch" style="background:#bb86fc;"></span> Violet</div>
      <div class="context-menu-item" onclick="setAccentColor('orange')"><span class="color-swatch" style="background:#ff9800;"></span> Orange</div>
      <div class="context-menu-item" onclick="setAccentColor('pink')"><span class="color-swatch" style="background:#ff4081;"></span> Rose</div>
      <div class="context-menu-item" onclick="setAccentColor('red')"><span class="color-swatch" style="background:#ff5252;"></span> Rouge</div>
    </div>
  </div>
  <div class="context-menu-separator" role="separator"></div>
  <div class="context-menu-item" role="menuitem" onclick="openWindow('terminal')">â¬›  Ouvrir Terminal</div>
  <div class="context-menu-item" role="menuitem" onclick="location.reload()">ðŸ”„  Actualiser</div>
</div>

<!-- ========== GLITCH OVERLAY ========== -->
<div class="glitch-overlay" id="glitchOverlay"></div>
<div class="glitch-text" id="glitchText">âš  SYSTEM FAILURE âš <br>AUTODESTRUCTION...</div>
<div class="fire-particles" id="fireParticles"></div>

<!-- ========== NOTIFICATION ========== -->
<div class="notification" id="notification" role="alert" onclick="this.classList.remove('show')">
  <div class="notification-content">
    <div class="notification-icon">ðŸ””</div>
    <div class="notification-body">
      <div class="notification-title" id="notifTitle">Bienvenue</div>
      <div class="notification-text" id="notifText">Portfolio chargÃ© avec succÃ¨s.</div>
    </div>
  </div>
  <div class="notification-progress"><div class="notification-progress-fill" id="notifProgress"></div></div>
</div>


<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
// ============================
// STATE
// ============================
const state = {
  windows: {},
  windowOrder: [],
  zCounter: 100,
  startMenuOpen: false,
  selfDestructActive: false,
  terminalHistory: [],
  terminalHistoryIndex: -1,
  notifTimer: null,
};

// ============================
// LOCAL STORAGE PERSISTENCE
// ============================
const LS_KEYS = {
  WALLPAPER: 'portfolio_wallpaper',
  ACCENT: 'portfolio_accent',
  SENT_EMAILS: 'portfolio_sentEmails',
  WINDOW_POSITIONS: 'portfolio_windowPositions',
};

function lsGet(key, fallback = null) {
  try {
    const val = localStorage.getItem(key);
    return val !== null ? JSON.parse(val) : fallback;
  } catch { return fallback; }
}

function lsSet(key, value) {
  try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
}

// ============================
// WALLPAPER (localStorage)
// ============================
const WALLPAPER_NAMES = {
  default: 'Cyber', nebula: 'NÃ©buleuse', matrix: 'Matrix',
  sunset: 'CrÃ©puscule', ocean: 'OcÃ©an', minimal: 'Minimal'
};

function setWallpaper(name) {
  const desktop = document.getElementById('desktop');
  desktop.className = desktop.className.replace(/\bwallpaper-\S+/g, '').trim();
  if (name !== 'default') {
    desktop.classList.add('wallpaper-' + name);
  }
  lsSet(LS_KEYS.WALLPAPER, name);
  showNotification('ðŸ–¼ï¸ Fond d\'Ã©cran', `Fond "${WALLPAPER_NAMES[name] || name}" appliquÃ© et sauvegardÃ©.`);
  updateWallpaperSwatches(name);
}

function loadWallpaper() {
  const saved = lsGet(LS_KEYS.WALLPAPER, 'default');
  if (saved !== 'default') {
    document.getElementById('desktop').classList.add('wallpaper-' + saved);
  }
  updateWallpaperSwatches(saved);
}

function updateWallpaperSwatches(active) {
  document.querySelectorAll('#wallpaperSubmenu .context-menu-item').forEach(item => {
    const swatch = item.querySelector('.color-swatch');
    if (!swatch) return;
    const onclick = item.getAttribute('onclick') || '';
    swatch.classList.toggle('active', onclick.includes("'" + active + "'"));
  });
}

// ============================
// ACCENT COLOR (localStorage)
// ============================
const ACCENT_COLORS = {
  cyan:   { primary: '#00d4ff', dark: '#00a0c4' },
  green:  { primary: '#00e676', dark: '#00b85c' },
  purple: { primary: '#bb86fc', dark: '#9a67ea' },
  orange: { primary: '#ff9800', dark: '#e68a00' },
  pink:   { primary: '#ff4081', dark: '#e03070' },
  red:    { primary: '#ff5252', dark: '#e04040' },
};

function setAccentColor(name) {
  const colors = ACCENT_COLORS[name];
  if (!colors) return;
  document.documentElement.style.setProperty('--primary', colors.primary);
  document.documentElement.style.setProperty('--primary-dark', colors.dark);
  lsSet(LS_KEYS.ACCENT, name);
  showNotification('ðŸŽ¨ Couleur d\'accent', `Couleur "${name}" appliquÃ©e et sauvegardÃ©e.`);
  updateAccentSwatches(name);
}

function loadAccentColor() {
  const saved = lsGet(LS_KEYS.ACCENT, 'cyan');
  const colors = ACCENT_COLORS[saved];
  if (colors) {
    document.documentElement.style.setProperty('--primary', colors.primary);
    document.documentElement.style.setProperty('--primary-dark', colors.dark);
  }
  updateAccentSwatches(saved);
}

function updateAccentSwatches(active) {
  document.querySelectorAll('#accentSubmenu .context-menu-item').forEach(item => {
    const swatch = item.querySelector('.color-swatch');
    if (!swatch) return;
    const onclick = item.getAttribute('onclick') || '';
    swatch.classList.toggle('active', onclick.includes("'" + active + "'"));
  });
}

// ============================
// EMAIL PERSISTENCE (localStorage)
// ============================
function loadSentEmails() {
  const saved = lsGet(LS_KEYS.SENT_EMAILS, []);
  saved.forEach(mail => { mail.date = new Date(mail.date); });
  sentEmails.push(...saved);
}

function saveSentEmails() {
  lsSet(LS_KEYS.SENT_EMAILS, sentEmails);
}

// ============================
// WINDOW POSITIONS (localStorage)
// ============================
function saveWindowPosition(id) {
  const win = state.windows[id];
  if (!win || win.classList.contains('maximized') || isMobile()) return;
  const positions = lsGet(LS_KEYS.WINDOW_POSITIONS, {});
  positions[id] = {
    left: win.style.left,
    top: win.style.top,
    width: win.style.width,
    height: win.style.height,
  };
  lsSet(LS_KEYS.WINDOW_POSITIONS, positions);
}

function getSavedWindowPosition(id) {
  const positions = lsGet(LS_KEYS.WINDOW_POSITIONS, {});
  return positions[id] || null;
}

// ============================
// BOOT SEQUENCE
// ============================
(function bootSequence() {
  const boot = document.getElementById('bootScreen');
  if (!boot) return;
  setTimeout(() => {
    boot.classList.add('hidden');
    setTimeout(() => boot.remove(), 600);
  }, 2200);
})();

// ============================
// CLOCK
// ============================
function updateClocks() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const timeStr = `${h}:${m}`;
  const options = { weekday:'long', day:'numeric', month:'long', year:'numeric' };
  const dateStr = now.toLocaleDateString('fr-FR', options);
  const shortDate = now.toLocaleDateString('fr-FR', { day:'2-digit', month:'2-digit', year:'numeric' });

  const lockTime = document.getElementById('lockTime');
  const lockDate = document.getElementById('lockDate');
  const taskbarTime = document.getElementById('taskbarTime');
  const taskbarDate = document.getElementById('taskbarDate');

  if (lockTime) lockTime.textContent = timeStr;
  if (lockDate) lockDate.textContent = dateStr;
  if (taskbarTime) taskbarTime.textContent = timeStr;
  if (taskbarDate) taskbarDate.textContent = shortDate;
}
updateClocks();
setInterval(updateClocks, 1000);

// ============================
// LOCK SCREEN
// ============================
function tryUnlock() {
  const input = document.getElementById('lockInput');
  const pwd = input.value;
  if (pwd === '1234') {
    input.style.border = '';
    document.getElementById('lockScreen').classList.add('unlocked');
    setTimeout(() => {
      showNotification('ðŸ‘‹ Bienvenue, Aymen !', 'Double-cliquez sur les icÃ´nes ou utilisez la barre des tÃ¢ches.');
    }, 1000);
    setTimeout(() => {
      openWindow('accueil');
    }, 1400);
  } else {
    input.value = '';
    input.style.border = '1px solid var(--accent-red)';
    input.placeholder = 'Mot de passe incorrect';
    input.classList.add('shake');
    setTimeout(() => input.classList.remove('shake'), 500);
  }
}

document.getElementById('unlockBtn').addEventListener('click', tryUnlock);
document.getElementById('lockInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') tryUnlock();
});

// ============================
// PARTICLES
// ============================
function createParticles() {
  const container = document.getElementById('particles');
  const fragment = document.createDocumentFragment();
  for (let i = 0; i < 30; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (8 + Math.random() * 15) + 's';
    p.style.animationDelay = (Math.random() * 10) + 's';
    p.style.width = p.style.height = (1 + Math.random() * 3) + 'px';
    if (Math.random() > 0.5) p.style.background = 'var(--accent-purple)';
    fragment.appendChild(p);
  }
  container.appendChild(fragment);
}
createParticles();

// ============================
// CONTEXT MENU
// ============================
document.getElementById('desktop').addEventListener('contextmenu', e => {
  e.preventDefault();
  // Ignore right-click inside a window
  if (e.target.closest('.os-window')) return;
  const cm = document.getElementById('contextMenu');
  // Clamp to viewport
  const x = Math.min(e.clientX, window.innerWidth - 220);
  const y = Math.min(e.clientY, window.innerHeight - 350);
  cm.style.left = x + 'px';
  cm.style.top = y + 'px';
  cm.classList.add('visible');
  // Flip submenus if near right edge
  cm.classList.toggle('flip-submenu', x + 420 > window.innerWidth);
});
document.addEventListener('click', () => {
  document.getElementById('contextMenu').classList.remove('visible');
});

// ============================
// START MENU
// ============================
function toggleStartMenu() {
  state.startMenuOpen = !state.startMenuOpen;
  document.getElementById('startMenu').classList.toggle('open', state.startMenuOpen);
  if (state.startMenuOpen) {
    document.getElementById('startSearch').value = '';
    document.querySelectorAll('#startApps .start-app').forEach(a => a.style.display = '');
  }
}
document.addEventListener('click', e => {
  if (state.startMenuOpen &&
      !document.getElementById('startMenu').contains(e.target) &&
      !document.getElementById('startBtn').contains(e.target)) {
    state.startMenuOpen = false;
    document.getElementById('startMenu').classList.remove('open');
  }
});

// Start menu search
document.getElementById('startSearch').addEventListener('input', function() {
  const q = this.value.toLowerCase();
  document.querySelectorAll('#startApps .start-app').forEach(app => {
    const label = app.querySelector('.start-app-label').textContent.toLowerCase();
    app.style.display = label.includes(q) ? '' : 'none';
  });
});

// ============================
// NOTIFICATION
// ============================
function showNotification(title, text, duration = 4000) {
  const n = document.getElementById('notification');
  const bar = document.getElementById('notifProgress');
  document.getElementById('notifTitle').textContent = title;
  document.getElementById('notifText').textContent = text;
  // Reset progress
  if (state.notifTimer) clearTimeout(state.notifTimer);
  bar.style.transition = 'none';
  bar.style.width = '100%';
  // Force reflow then animate
  bar.offsetWidth;
  bar.style.transition = `width ${duration}ms linear`;
  bar.style.width = '0%';
  n.classList.add('show');
  state.notifTimer = setTimeout(() => n.classList.remove('show'), duration);
}

// ============================
// WINDOW TEMPLATES
// ============================
function getWindowContent(id) {
  const templates = {
    accueil: {
      title: 'Accueil.html â€” Navigateur',
      icon: 'ðŸŒ',
      width: 750, height: 520,
      content: `
        <div class="browser-toolbar">
          <button class="browser-nav-btn">â—€</button>
          <button class="browser-nav-btn">â–¶</button>
          <button class="browser-nav-btn">âŸ³</button>
          <input class="browser-url" value="https://aymen-louraghi.dev/accueil" readonly>
        </div>
        <div class="accueil-content">
          <div class="accueil-greeting">// BIENVENUE SUR MON PORTFOLIO</div>
          <h1 class="accueil-title">
            PassionnÃ© par les <span class="highlight">RÃ©seaux</span><br>
            &amp; la <span class="highlight">CybersÃ©curitÃ©</span>
          </h1>
          <div class="terminal-text" id="typingTerminal">
            <span class="prompt">aymen@portfolio:~$</span> <span id="typedText"></span><span class="cursor"></span>
          </div>
          <div class="accueil-tags">
            <span class="accueil-tag">ðŸŽ“ BTS SIO SISR</span>
            <span class="accueil-tag">ðŸ¢ Alternance Konvergence</span>
            <span class="accueil-tag">ðŸ”’ CybersÃ©curitÃ©</span>
            <span class="accueil-tag">ðŸŒ RÃ©seaux</span>
            <span class="accueil-tag">ðŸ§ Linux</span>
          </div>
        </div>
      `
    },
    apropos: {
      title: 'Ã€_Propos.txt â€” Code Editor',
      icon: 'ðŸ“',
      width: 780, height: 550,
      content: `
        <div class="editor-container">
          <div class="editor-sidebar">
            <div class="editor-sidebar-icon active">ðŸ“„</div>
            <div class="editor-sidebar-icon">ðŸ”</div>
            <div class="editor-sidebar-icon">ðŸ”€</div>
            <div class="editor-sidebar-icon">ðŸ§©</div>
          </div>
          <div class="editor-main">
            <div class="editor-tabs">
              <div class="editor-tab active">ðŸ“„ Ã _propos.json</div>
              <div class="editor-tab">ðŸ“„ skills.js</div>
            </div>
            <div class="editor-code">
              <div class="code-line"><span class="cm">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></div>
              <div class="code-line"><span class="cm">//  Ã€ PROPOS â€” Aymen Louraghi</span></div>
              <div class="code-line"><span class="cm">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></div>
              <div class="code-line">&nbsp;</div>
              <div class="code-line"><span class="kw">const</span> <span class="prop">profil</span> = {</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">nom</span>: <span class="str">"Aymen Louraghi"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">Ã¢ge</span>: <span class="num">19</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">formation</span>: <span class="str">"BTS SIO option SISR"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">Ã©cole</span>: <span class="str">"CFP Les Charmilles"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">alternance</span>: <span class="str">"Konvergence"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">localisation</span>: <span class="str">"235 rue de Corporat Moirans"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">passions</span>: [</div>
              <div class="code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"RÃ©seaux & Infrastructures"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"CybersÃ©curitÃ©"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"Administration SystÃ¨mes"</span>,</div>
              <div class="code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"Automatisation de procÃ©dÃ©s"</span></div>
              <div class="code-line">&nbsp;&nbsp;],</div>
              <div class="code-line">&nbsp;&nbsp;<span class="prop">objectif</span>: <span class="str">"Devenir Technicien de maintenance informatique"</span></div>
              <div class="code-line">};</div>
              <div class="code-line">&nbsp;</div>
              <div class="code-line"><span class="cm">// Actuellement en alternance, je conÃ§ois</span></div>
              <div class="code-line"><span class="cm">// et dÃ©ploie des infrastructures rÃ©seau</span></div>
              <div class="code-line"><span class="cm">// tout en renforÃ§ant leur sÃ©curitÃ©.</span></div>
            </div>
          </div>
        </div>
      `
    },
    realisations: {
      title: 'RÃ©alisations â€” Explorateur',
      icon: 'ðŸ“',
      width: 850, height: 580,
      content: `
        <div class="explorer-toolbar">
          <div class="explorer-breadcrumb">
            <span>ðŸ’» Ce PC</span> â€º <span>ðŸ“ CompÃ©tences</span> â€º <span>RÃ©alisations</span>
          </div>
        </div>
        <div class="explorer-content">
          <div class="explorer-files" id="explorerFiles">
            <div style="grid-column:1/-1;font-size:0.7rem;color:var(--text-muted);font-weight:600;letter-spacing:0.5px;padding:4px 0;border-bottom:1px solid var(--border);margin-bottom:4px;">ðŸ§  COMPÃ‰TENCES</div>
            <div class="file-item" onclick="selectProject(this, 0)">
              <div class="file-icon">ðŸŒ</div>
              <div class="file-name">Cisco / RÃ©seau</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 1)">
              <div class="file-icon">ðŸ§</div>
              <div class="file-name">Linux</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 2)">
              <div class="file-icon">ðŸªŸ</div>
              <div class="file-name">Windows Server</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 3)">
              <div class="file-icon">ðŸ›¡ï¸</div>
              <div class="file-name">CybersÃ©curitÃ©</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 4)">
              <div class="file-icon">ðŸ“¡</div>
              <div class="file-name">Active Directory</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 5)">
              <div class="file-icon">ðŸ</div>
              <div class="file-name">Python</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 6)">
              <div class="file-icon">ðŸ”§</div>
              <div class="file-name">GLPI / ITSM</div>
            </div>
            <div class="file-item" onclick="selectProject(this, 7)">
              <div class="file-icon">â˜ï¸</div>
              <div class="file-name">Virtualisation</div>
            </div>
          </div>
          <div class="explorer-detail" id="explorerDetail">
            <div class="detail-header">
              <div class="detail-icon" id="detailIcon">ðŸ§ </div>
              <div class="detail-title" id="detailTitle">SÃ©lectionnez une compÃ©tence</div>
            </div>
            <div class="detail-meta" id="detailMeta">
              <span>CatÃ©gorie : â€”</span>
              <span>Niveau : â€”</span>
            </div>
            <div class="detail-desc" id="detailDesc">Cliquez sur une compÃ©tence pour voir ses dÃ©tails.</div>
            <div class="detail-tags" id="detailTags"></div>
          </div>
        </div>
      `
    },
    scolarite: {
      title: 'ScolaritÃ© â€” Explorateur',
      icon: 'ðŸŽ“',
      width: 900, height: 600,
      content: `
        <div class="scolaire-container">
          <div class="scolaire-tree" id="scolariteTree"></div>
          <div class="scolaire-main">
            <div class="scolaire-toolbar">
              <div class="scolaire-path" id="scolaritePath">
                <span onclick="navigateScolarite('root')">ðŸ’» Ce PC</span>
                <span class="scolaire-path-sep">â€º</span>
                <span onclick="navigateScolarite('root')">ðŸŽ“ ScolaritÃ©</span>
              </div>
            </div>
            <div style="display:flex;flex:1;overflow:hidden;">
              <div class="scolaire-grid" id="scolariteGrid"></div>
              <div class="scolaire-detail" id="scolariteDetail">
                <div class="scolaire-detail-header">
                  <div class="scolaire-detail-icon" id="scoDetailIcon">ðŸ“„</div>
                  <div class="scolaire-detail-title" id="scoDetailTitle">SÃ©lectionnez un fichier</div>
                </div>
                <div class="scolaire-detail-meta" id="scoDetailMeta"><span>â€”</span></div>
                <div class="scolaire-detail-desc" id="scoDetailDesc">Cliquez sur un fichier pour voir ses dÃ©tails.</div>
                <div class="scolaire-detail-tags" id="scoDetailTags"></div>
                <button class="scolaire-open-btn" id="scoOpenBtn" style="display:none;" onclick="openCurrentScolariteFile()">ðŸ“„ Ouvrir le document</button>
              </div>
            </div>
            <div class="scolaire-statusbar">
              <span id="scolariteCount">0 Ã©lÃ©ments</span>
              <span id="scolariteLocation">ScolaritÃ©</span>
            </div>
          </div>
        </div>
      `
    },
    projets: {
      title: 'Projets â€” Tableau de bord',
      icon: 'ðŸ“‚',
      width: 880, height: 600,
      content: `
        <div class="projets-container">
          <div class="projets-tabs">
            <button class="projets-tab active" onclick="switchProjetTab(this, 'all')">ðŸ“‹ Tout <span class="projets-tab-count" id="countAll">0</span></button>
            <button class="projets-tab" onclick="switchProjetTab(this, 'ecole')">ðŸŽ“ Ã‰cole <span class="projets-tab-count" id="countEcole">0</span></button>
            <button class="projets-tab" onclick="switchProjetTab(this, 'entreprise')">ðŸ¢ Entreprise <span class="projets-tab-count" id="countEntreprise">0</span></button>
            <button class="projets-tab" onclick="switchProjetTab(this, 'perso')">ðŸ  Personnel <span class="projets-tab-count" id="countPerso">0</span></button>
          </div>
          <div class="projets-panel active" id="projetsContent"></div>
          <div class="projets-legend">
            <div class="projets-legend-item"><div class="projets-legend-dot" style="background:var(--accent-green)"></div> TerminÃ©</div>
            <div class="projets-legend-item"><div class="projets-legend-dot" style="background:var(--accent-yellow)"></div> En cours</div>
            <div class="projets-legend-item"><div class="projets-legend-dot" style="background:var(--text-muted)"></div> PlanifiÃ©</div>
          </div>
        </div>
      `
    },
    contact: {
      title: 'Contact â€” Outlook',
      icon: 'ðŸ“¨',
      width: 780, height: 540,
      content: `
        <div class="mail-container" style="position:relative;">
          <div class="mail-sidebar-left">
            <div class="mail-sidebar-header">ðŸ“§ Mail</div>
            <button class="mail-compose-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
            <div class="mail-folders">
              <div class="mail-folder active" onclick="switchMailFolder(this, 'inbox')">ðŸ“¥ BoÃ®te de rÃ©ception <span class="mail-folder-badge">1</span></div>
              <div class="mail-folder" onclick="switchMailFolder(this, 'sent')">ðŸ“¤ Ã‰lÃ©ments envoyÃ©s <span class="mail-folder-badge" id="sentCount" style="display:none;">0</span></div>
              <div class="mail-folder" onclick="switchMailFolder(this, 'drafts')">ðŸ“ Brouillons</div>
              <div class="mail-folder">â­ Favoris</div>
              <div class="mail-folder">ðŸ—‘ï¸ Ã‰lÃ©ments supprimÃ©s</div>
              <div class="mail-folder">ðŸ“ Archive</div>
            </div>
            <div class="mail-sidebar-footer">
              <div class="mail-sidebar-avatar">V</div>
              <span>Visiteur</span>
            </div>
          </div>
          <div class="mail-main">
            <div class="mail-toolbar">
              <button class="mail-toolbar-btn" onclick="document.getElementById('contactForm').requestSubmit()">ðŸ“¤ Envoyer</button>
              <div class="mail-toolbar-sep"></div>
              <button class="mail-toolbar-btn">ðŸ“Ž Joindre</button>
              <button class="mail-toolbar-btn" onclick="resetContactForm()">ðŸ—‘ï¸ Supprimer</button>
              <div style="flex:1;"></div>
              <div class="contact-links" style="margin:0;gap:6px;">
                <a class="contact-link" href="mailto:aymen.louraghi38@gmail.com" style="padding:5px 10px;font-size:0.7rem;">
                  <span class="contact-link-icon" style="font-size:0.85rem;">ðŸ“§</span> Email
                </a>
                <a class="contact-link" href="https://fr.linkedin.com/in/aymen-louraghi-887ab9312" target="_blank" style="padding:5px 10px;font-size:0.7rem;">
                  <span class="contact-link-icon" style="font-size:0.85rem;">ðŸ’¼</span> LinkedIn
                </a>
              </div>
            </div>
            <form class="mail-compose-area" id="contactForm" onsubmit="handleContactSubmit(event)">
              <div class="mail-compose-fields">
                <div class="mail-field-row">
                  <span class="mail-field-label">De :</span>
                  <input class="mail-field-input" id="contactFrom" type="email" name="from_email" placeholder="votre@email.com" required>
                </div>
                <div class="mail-field-row">
                  <span class="mail-field-label">Ã€ :</span>
                  <span class="mail-field-static">aymen.louraghi38@gmail.com</span>
                </div>
                <div class="mail-field-row">
                  <span class="mail-field-label">Nom :</span>
                  <input class="mail-field-input" id="contactName" type="text" name="from_name" placeholder="Votre nom" required>
                </div>
                <div class="mail-field-row">
                  <span class="mail-field-label">Objet :</span>
                  <input class="mail-field-input" id="contactSubject" type="text" name="subject" placeholder="Objet du message" required>
                </div>
              </div>
              <div class="mail-body-area">
                <textarea class="mail-body-textarea" id="contactMessage" name="message" placeholder="RÃ©digez votre message ici..." required></textarea>
              </div>
              <div class="mail-statusbar">
                <span id="mailStatus">PrÃªt</span>
                <button type="submit" class="mail-send-btn" id="mailSendBtn">ðŸ“¤ Envoyer</button>
              </div>
            </form>
          </div>
          <div id="mailSentOverlay" style="display:none;"></div>
        </div>
      `
    },
    terminal: {
      title: 'Terminal â€” PowerShell',
      icon: 'â¬›',
      width: 680, height: 440,
      content: `
        <div class="terminal-container">
          <div class="terminal-header-bar">
            <div class="terminal-tab-item active">PowerShell</div>
          </div>
          <div class="terminal-output" id="terminalOutput">
            <div><span class="t-info">Aymen OS Terminal v2.0</span></div>
            <div><span class="t-result">Tapez <span class="t-cmd">"help"</span> pour voir les commandes disponibles.</span></div>
            <div>&nbsp;</div>
          </div>
          <div class="terminal-input-line">
            <span class="terminal-prompt-text">aymen@portfolio:~$</span>
            <input class="terminal-input" id="terminalInput" type="text" autofocus spellcheck="false" autocomplete="off">
          </div>
        </div>
      `
    },
    cv: {
      title: 'CV.pdf â€” Lecteur PDF',
      icon: 'ðŸ“„',
      width: 720, height: 600,
      content: `
        <div class="doc-viewer">
          <div class="doc-viewer-toolbar">
            <span class="doc-viewer-title">ðŸ“„ CV_2026-02-18_Aymen_LOURAGHI.pdf</span>
            <div class="doc-viewer-actions">
              <button class="doc-viewer-btn" onclick="window.open('CV_2026-02-18_Aymen_LOURAGHI.pdf', '_blank')">ðŸ”— Nouvel onglet</button>
              <button class="doc-viewer-btn primary" onclick="downloadCV()">â¬‡ï¸ TÃ©lÃ©charger le CV</button>
            </div>
          </div>
          <iframe class="doc-viewer-frame" src="CV_2026-02-18_Aymen_LOURAGHI.pdf" title="CV Aymen Louraghi"></iframe>
        </div>
      `
    }
  };
  return templates[id];
}

// ============================
// PROJECT DATA
// ============================
const projects = [
  // â”€â”€ COMPÃ‰TENCES â”€â”€
  {
    icon: 'ðŸŒ', title: 'Cisco / RÃ©seau',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 85%', 'Type : RÃ©seau'],
    desc: 'Configuration et administration d\'Ã©quipements Cisco (routeurs, switchs). CrÃ©ation de VLANs, configuration des appareils via un Terminal, Conception d\'architectures rÃ©seau complÃ¨tes.',
    tags: ['Cisco IOS', 'OSPF', 'VLAN', 'ACL', 'NAT', 'Packet Tracer']
  },
  {
    icon: 'ðŸ§', title: 'Linux',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 80%', 'Type : SystÃ¨me'],
    desc: 'Administration avancÃ©e de systÃ¨mes Linux (Debian, Ubuntu, CentOS). Gestion des services (Apache, GLPI, DHCP), scripting Bash, gestion des permissions, iptables/nftables, et supervision.',
    tags: ['Debian', 'Ubuntu', 'Bash', 'Apache', 'iptables', 'systemd']
  },
  {
    icon: 'ðŸªŸ', title: 'Windows Server',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 82%', 'Type : SystÃ¨me'],
    desc: 'DÃ©ploiement et administration de Windows Server (2012-2025). Active Directory, GPO, DNS, DHCP, serveur de fichiers (APP), Hyper-V, PowerShell, gestion des rÃ´les et fonctionnalitÃ©s, stratÃ©gies de sÃ©curitÃ©.',
    tags: ['Windows Server', 'AD DS', 'GPO', 'PowerShell', 'Hyper-V', 'DNS']
  },
  {
    icon: 'ðŸ›¡ï¸', title: 'CybersÃ©curitÃ©',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 70%', 'Type : SÃ©curitÃ©'],
    desc: 'Sensibilisation et mise en pratique de la sÃ©curitÃ© informatique : analyse de vulnÃ©rabilitÃ©s, durcissement de systÃ¨mes (mise en place d\'anti-virus ESET), gestion des pare-feu, analyse de logs, veille en cybersÃ©curitÃ©, conformitÃ© et bonnes pratiques.',
    tags: ['Nmap', 'Wireshark', 'Kali Linux', 'Firewall', 'Hardening', 'SIEM']
  },
  {
    icon: 'ðŸ“¡', title: 'Active Directory',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 78%', 'Type : Infrastructure'],
    desc: 'Conception et administration d\'environnements Active Directory : arborescence OU, stratÃ©gies de groupe (GPO), dÃ©lÃ©gation, rÃ©plication, gestion des utilisateurs/groupes, scripts PowerShell d\'automatisation.',
    tags: ['AD DS', 'GPO', 'OU', 'PowerShell', 'DNS intÃ©grÃ©', 'RÃ©plication']
  },
  {
    icon: 'ðŸ', title: 'Python',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 35%', 'Type : DÃ©veloppement'],
    desc: 'Programmation en Python pour l\'automatisation de tÃ¢ches systÃ¨me et rÃ©seau : scripts d\'administration, parsing de logs, interaction avec des API REST, crÃ©ation d\'outils de monitoring et de sÃ©curitÃ©.',
    tags: ['Python 3', 'Automatisation', 'API REST', 'Scripting', 'Paramiko', 'Netmiko']
  },
  {
    icon: 'ðŸ”§', title: 'GLPI / ITSM',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 75%', 'Type : Gestion'],
    desc: 'DÃ©ploiement et administration de GLPI pour la gestion de parc et le helpdesk : inventaire automatisÃ© avec FusionInventory, gestion des tickets, reporting et tableaux de bord.',
    tags: ['GLPI', 'FusionInventory', 'Helpdesk', 'ITIL', 'MySQL', 'Reporting']
  },
  {
    icon: 'â˜ï¸', title: 'Virtualisation',
    meta: ['CatÃ©gorie : CompÃ©tence', 'Niveau : 72%', 'Type : Infrastructure'],
    desc: 'Mise en Å“uvre et/ou utilisation de solutions de virtualisation : VMwar, Hyper-V, VirtualBox. CrÃ©ation et gestion de VMs, snapshots, migration, allocation de ressources, rÃ©seau virtuel et stockage.',
    tags: ['VMware', 'ESXi', 'Hyper-V', 'VirtualBox', 'vSwitch', 'Snapshots']
  }
];

function selectProject(el, index) {
  document.querySelectorAll('.file-item').forEach(f => f.classList.remove('selected'));
  el.classList.add('selected');
  const p = projects[index];
  const detail = document.getElementById('explorerDetail');
  detail.classList.add('open');
  document.getElementById('detailIcon').textContent = p.icon;
  document.getElementById('detailTitle').textContent = p.title;
  document.getElementById('detailMeta').innerHTML = p.meta.map(m => `<span>${m}</span>`).join('');
  document.getElementById('detailDesc').textContent = p.desc;
  document.getElementById('detailTags').innerHTML = p.tags.map(t => `<span class="detail-tag">${t}</span>`).join('');
}

// ============================
// SCOLARITÃ‰ - FILE EXPLORER TREE
// ============================
const scolariteData = {
  id: 'root',
  name: 'ScolaritÃ©',
  icon: 'ðŸŽ“',
  type: 'folder',
  children: [
    {
      id: 'annee1',
      name: 'AnnÃ©e 1 (2024-2025)',
      icon: 'ðŸ“',
      type: 'folder',
      children: [
        {
          id: 'a1-cisco',
          name: 'TP_RÃ©seau_Cisco.pkt',
          icon: 'ðŸŒ',
          type: 'file',
          fileUrl: 'docs/TP_Reseau_Cisco.pdf',
          meta: ['Type : Packet Tracer', 'Taille : 2.4 Mo', 'Date : Sept 2024', 'Contexte : TP Ã©cole'],
          desc: 'Configuration de routeurs et switchs Cisco : VLAN, routage inter-VLAN, ACL, NAT/PAT sur Packet Tracer.',
          tags: ['Cisco', 'VLAN', 'Routage', 'Packet Tracer']
        },
        {
          id: 'a1-linux',
          name: 'Admin_Linux.sh',
          icon: 'ðŸ§',
          type: 'file',
          fileUrl: 'docs/Admin_Linux.pdf',
          meta: ['Type : Script Bash', 'Taille : 18 Ko', 'Date : Oct 2024', 'Contexte : TP Ã©cole'],
          desc: 'Administration de serveurs Debian : gestion des services Apache, Bind9, DHCP, scripting Bash et permissions.',
          tags: ['Debian', 'Bash', 'Apache', 'Services']
        },
        {
          id: 'a1-windows',
          name: 'Windows_Server.docx',
          icon: 'ðŸªŸ',
          type: 'file',
          fileUrl: 'docs/Windows_Server.pdf',
          meta: ['Type : Document', 'Taille : 5.1 Mo', 'Date : Nov 2024', 'Contexte : TP Ã©cole'],
          desc: 'DÃ©ploiement Windows Server : installation AD DS, DNS, DHCP, crÃ©ation d\'OU et stratÃ©gies GPO.',
          tags: ['Windows Server', 'AD DS', 'GPO', 'DNS']
        },
        {
          id: 'a1-sql',
          name: 'Base_DonnÃ©es.sql',
          icon: 'ðŸ’¾',
          type: 'file',
          fileUrl: 'docs/Base_Donnees.pdf',
          meta: ['Type : Script SQL', 'Taille : 42 Ko', 'Date : DÃ©c 2024', 'Contexte : Cours'],
          desc: 'Conception et manipulation de bases de donnÃ©es relationnelles : MCD/MLD, requÃªtes SQL, jointures, vues.',
          tags: ['MySQL', 'SQL', 'MCD', 'PhpMyAdmin']
        },
        {
          id: 'a1-python',
          name: 'Projet_Python.py',
          icon: 'ðŸ',
          type: 'file',
          fileUrl: 'docs/Projet_Python.pdf',
          meta: ['Type : Script Python', 'Taille : 8 Ko', 'Date : Jan 2025', 'Contexte : TP Ã©cole'],
          desc: 'Programmation Python : algorithmique, structures de donnÃ©es, scripts d\'automatisation rÃ©seau.',
          tags: ['Python 3', 'Algorithmique', 'Scripting']
        }
      ]
    },
    {
      id: 'annee2',
      name: 'AnnÃ©e 2 (2025-2026)',
      icon: 'ðŸ“',
      type: 'folder',
      children: [
        {
          id: 'a2-cybersec',
          name: 'Audit_SÃ©curitÃ©.pdf',
          icon: 'ðŸ›¡ï¸',
          type: 'file',
          fileUrl: 'docs/Audit_Securite.pdf',
          meta: ['Type : Rapport PDF', 'Taille : 3.8 Mo', 'Date : Sept 2025', 'Contexte : TP Ã©cole'],
          desc: 'Module cybersÃ©curitÃ© : scan de ports Nmap, analyse de trames Wireshark, identification de vulnÃ©rabilitÃ©s.',
          tags: ['Nmap', 'Wireshark', 'SÃ©curitÃ©', 'Audit']
        },
        {
          id: 'a2-glpi',
          name: 'GLPI_Config.conf',
          icon: 'ðŸ”§',
          type: 'file',
          fileUrl: 'docs/GLPI_Config.pdf',
          meta: ['Type : Configuration', 'Taille : 12 Ko', 'Date : Oct 2025', 'Contexte : Entreprise'],
          desc: 'DÃ©ploiement GLPI : inventaire FusionInventory, gestion de tickets helpdesk, reporting.',
          tags: ['GLPI', 'FusionInventory', 'Helpdesk', 'ITIL']
        },
        {
          id: 'a2-virtualisation',
          name: 'Infra_Virtuelle.vmx',
          icon: 'â˜ï¸',
          type: 'file',
          fileUrl: 'docs/Infra_Virtuelle.pdf',
          meta: ['Type : Config VMware', 'Taille : 4 Ko', 'Date : Nov 2025', 'Contexte : TP Ã©cole'],
          desc: 'Virtualisation avec VMware et Hyper-V : crÃ©ation de VMs, snapshots, migration, rÃ©seau virtuel.',
          tags: ['VMware', 'Hyper-V', 'VirtualBox', 'ESXi']
        },
        {
          id: 'a2-portfolio',
          name: 'Portfolio.html',
          icon: 'ðŸ’»',
          type: 'file',
          fileUrl: 'docs/Portfolio.pdf',
          meta: ['Type : Page Web', 'Taille : 156 Ko', 'Date : FÃ©v 2026', 'Contexte : Personnel'],
          desc: 'CrÃ©ation de ce portfolio interactif simulant un OS : HTML, CSS, JavaScript vanilla.',
          tags: ['HTML5', 'CSS3', 'JavaScript', 'Portfolio']
        }
      ]
    }
  ]
};

let scolariteCurrentPath = 'root';

function initScolarite() {
  buildScolariteTree();
  navigateScolarite('root');
}

function buildScolariteTree() {
  const treeEl = document.getElementById('scolariteTree');
  if (!treeEl) return;
  treeEl.innerHTML = renderTreeNode(scolariteData, 0);
}

function renderTreeNode(node, depth) {
  if (node.type !== 'folder') return '';
  const hasChildren = node.children && node.children.some(c => c.type === 'folder');
  const chevronClass = hasChildren ? '' : 'empty';
  let html = `<div class="tree-node" data-id="${node.id}">`;
  html += `<div class="tree-node-header" style="--tree-depth:${depth}" onclick="onTreeNodeClick('${node.id}')">`;
  html += `<span class="tree-chevron ${chevronClass}" id="chevron-${node.id}">â–¶</span>`;
  html += `<span class="tree-node-icon">${node.icon}</span>`;
  html += `<span class="tree-node-label">${node.name}</span>`;
  html += `</div>`;
  if (node.children) {
    html += `<div class="tree-children" id="tree-children-${node.id}">`;
    node.children.forEach(child => {
      if (child.type === 'folder') {
        html += renderTreeNode(child, depth + 1);
      }
    });
    html += `</div>`;
  }
  html += `</div>`;
  return html;
}

function onTreeNodeClick(nodeId) {
  // Toggle tree expansion
  const childrenEl = document.getElementById('tree-children-' + nodeId);
  const chevron = document.getElementById('chevron-' + nodeId);
  if (childrenEl) {
    childrenEl.classList.toggle('open');
  }
  if (chevron && !chevron.classList.contains('empty')) {
    chevron.classList.toggle('open');
  }
  // Navigate to this folder
  navigateScolarite(nodeId);
}

function findNode(node, id) {
  if (node.id === id) return node;
  if (node.children) {
    for (const child of node.children) {
      const found = findNode(child, id);
      if (found) return found;
    }
  }
  return null;
}

function getNodePath(node, targetId, path = []) {
  path.push(node);
  if (node.id === targetId) return [...path];
  if (node.children) {
    for (const child of node.children) {
      const result = getNodePath(child, targetId, [...path]);
      if (result) return result;
    }
  }
  return null;
}

function navigateScolarite(nodeId) {
  const node = findNode(scolariteData, nodeId);
  if (!node) return;
  scolariteCurrentPath = nodeId;

  // Update tree active states
  document.querySelectorAll('.tree-node-header').forEach(h => h.classList.remove('active'));
  const activeHeader = document.querySelector(`.tree-node[data-id="${nodeId}"] > .tree-node-header`);
  if (activeHeader) activeHeader.classList.add('active');

  // Update breadcrumb path
  const pathEl = document.getElementById('scolaritePath');
  if (pathEl) {
    const breadcrumb = getNodePath(scolariteData, nodeId);
    if (breadcrumb) {
      pathEl.innerHTML = `<span onclick="navigateScolarite('root')">ðŸ’» Ce PC</span>`;
      breadcrumb.forEach((b, i) => {
        pathEl.innerHTML += `<span class="scolaire-path-sep">â€º</span>`;
        pathEl.innerHTML += `<span onclick="navigateScolarite('${b.id}')">${b.icon} ${b.name}</span>`;
      });
    }
  }

  // Render grid contents
  const grid = document.getElementById('scolariteGrid');
  if (!grid) return;

  const items = node.children || [];
  if (items.length === 0) {
    grid.innerHTML = `<div class="scolaire-empty"><div class="scolaire-empty-icon">ðŸ“‚</div><div>Ce dossier est vide</div></div>`;
  } else {
    grid.innerHTML = items.map(item => `
      <div class="scolaire-item" onclick="onScolariteItemClick('${item.id}')" ondblclick="onScolariteItemDblClick('${item.id}')">
        <div class="scolaire-item-icon">${item.icon}</div>
        <div class="scolaire-item-name">${item.name}</div>
        ${item.type === 'folder' ? `<div class="scolaire-item-meta">${(item.children || []).length} Ã©lÃ©ments</div>` : `<div class="scolaire-item-meta">${(item.meta && item.meta[1]) || ''}</div>`}
      </div>
    `).join('');
  }

  // Update statusbar
  const countEl = document.getElementById('scolariteCount');
  const locEl = document.getElementById('scolariteLocation');
  if (countEl) countEl.textContent = `${items.length} Ã©lÃ©ment${items.length !== 1 ? 's' : ''}`;
  if (locEl) locEl.textContent = node.name;

  // Close detail panel
  const detail = document.getElementById('scolariteDetail');
  if (detail) detail.classList.remove('open');
}

function onScolariteItemClick(itemId) {
  const item = findNode(scolariteData, itemId);
  if (!item) return;

  // Visual selection
  document.querySelectorAll('.scolaire-item').forEach(i => i.classList.remove('selected'));
  event.currentTarget.classList.add('selected');

  if (item.type === 'file') {
    // Show detail panel
    const detail = document.getElementById('scolariteDetail');
    detail.classList.add('open');
    document.getElementById('scoDetailIcon').textContent = item.icon;
    document.getElementById('scoDetailTitle').textContent = item.name;
    document.getElementById('scoDetailMeta').innerHTML = (item.meta || []).map(m => `<span>${m}</span>`).join('');
    document.getElementById('scoDetailDesc').textContent = item.desc || '';
    document.getElementById('scoDetailTags').innerHTML = (item.tags || []).map(t => `<span class="scolaire-detail-tag">${t}</span>`).join('');
    // Show/hide open button
    const openBtn = document.getElementById('scoOpenBtn');
    if (openBtn) {
      if (item.fileUrl) {
        openBtn.style.display = '';
        openBtn.dataset.fileId = item.id;
      } else {
        openBtn.style.display = 'none';
      }
    }
  }
}

function onScolariteItemDblClick(itemId) {
  const item = findNode(scolariteData, itemId);
  if (!item) return;
  if (item.type === 'folder') {
    // Navigate into folder
    navigateScolarite(itemId);
    // Also expand tree node
    const childrenEl = document.getElementById('tree-children-' + itemId);
    const chevron = document.getElementById('chevron-' + itemId);
    if (childrenEl) childrenEl.classList.add('open');
    if (chevron) chevron.classList.add('open');
  } else if (item.type === 'file' && item.fileUrl) {
    openDocumentViewer(item);
  }
}

function openCurrentScolariteFile() {
  const btn = document.getElementById('scoOpenBtn');
  if (!btn || !btn.dataset.fileId) return;
  const item = findNode(scolariteData, btn.dataset.fileId);
  if (item && item.fileUrl) openDocumentViewer(item);
}

let docViewerCounter = 0;

function openDocumentViewer(fileItem) {
  docViewerCounter++;
  const winId = 'docview-' + docViewerCounter;
  const fileName = fileItem.name;
  const fileUrl = fileItem.fileUrl;
  const icon = fileItem.icon || 'ðŸ“„';

  const win = document.createElement('div');
  win.className = 'os-window focused';
  win.id = 'window-' + winId;
  win.dataset.windowId = winId;
  win.style.width = '850px';
  win.style.height = '620px';

  const offset = Object.keys(state.windows).length * 30;
  win.style.left = Math.max(60, (window.innerWidth - 850) / 2 + offset) + 'px';
  win.style.top = Math.max(30, (window.innerHeight - 620 - 52) / 2 + offset) + 'px';
  win.style.zIndex = ++state.zCounter;

  win.innerHTML = `
    <div class="window-titlebar" data-drag="true">
      <span class="window-titlebar-icon">${icon}</span>
      <span class="window-titlebar-text">${fileName} â€” Lecteur PDF</span>
      <div class="window-controls">
        <button class="window-ctrl-btn minimize-btn" onclick="minimizeWindow('${winId}')" title="RÃ©duire">â”€</button>
        <button class="window-ctrl-btn maximize-btn" onclick="maximizeWindow('${winId}')" title="Agrandir">â–¡</button>
        <button class="window-ctrl-btn close-btn" onclick="closeWindow('${winId}')" title="Fermer">âœ•</button>
      </div>
    </div>
    <div class="window-body">
      <div class="doc-viewer">
        <div class="doc-viewer-toolbar">
          <span class="doc-viewer-title">${icon} ${fileName}</span>
          <div class="doc-viewer-actions">
            <button class="doc-viewer-btn" onclick="window.open('${fileUrl}', '_blank')">ðŸ”— Nouvel onglet</button>
            <button class="doc-viewer-btn primary" onclick="downloadDoc('${fileUrl}', '${fileName}')">â¬‡ï¸ TÃ©lÃ©charger</button>
          </div>
        </div>
        <iframe class="doc-viewer-frame" src="${fileUrl}" title="${fileName}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';"></iframe>
        <div class="doc-viewer-fallback" style="display:none;">
          <div class="doc-viewer-fallback-icon">ðŸ“„</div>
          <div class="doc-viewer-fallback-title">${fileName}</div>
          <div class="doc-viewer-fallback-text">Le fichier PDF n'a pas pu Ãªtre chargÃ©.<br>VÃ©rifiez que le fichier existe dans le dossier <strong>docs/</strong></div>
          <button class="doc-viewer-btn primary" onclick="window.open('${fileUrl}', '_blank')" style="margin-top:0.5rem;">ðŸ”— Ouvrir dans un nouvel onglet</button>
        </div>
      </div>
    </div>
    <div class="resize-handle" data-resize="true"></div>
  `;

  document.getElementById('desktop').appendChild(win);
  state.windows[winId] = win;
  state.windowOrder.push(winId);
  focusWindow(winId);
  updateTaskbar();
  initDrag(win, winId);
  if (!isMobile()) initResize(win);
  win.addEventListener('mousedown', () => focusWindow(winId));
}

function downloadDoc(url, name) {
  const a = document.createElement('a');
  a.href = url;
  a.download = name.replace(/\.[^.]+$/, '') + '.pdf';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  showNotification('ðŸ“„ TÃ©lÃ©chargement', `TÃ©lÃ©chargement de ${name}...`);
}

// ============================
// PROJETS DATA & LOGIC
// ============================
const projetsData = [
  // â”€â”€â”€ ðŸŽ“ Ã‰COLE â”€â”€â”€
  {
    icon: 'ðŸŒ', title: 'Configuration RÃ©seau Cisco',
    context: 'ecole', category: 'RÃ©seau & TÃ©lÃ©com',
    desc: 'Travaux pratiques de configuration de routeurs et switchs Cisco : VLAN, routage inter-VLAN, ACL, NAT/PAT, protocoles OSPF et EIGRP sur Packet Tracer.',
    tags: ['Cisco', 'VLAN', 'OSPF', 'Packet Tracer'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸ“¡', title: 'Mise en place Active Directory',
    context: 'ecole', category: 'SystÃ¨mes & Infrastructure',
    desc: 'TP de dÃ©ploiement d\'un domaine AD : crÃ©ation d\'OU, gestion des utilisateurs/groupes, stratÃ©gies GPO, DNS et DHCP intÃ©grÃ©s.',
    tags: ['Windows Server', 'AD DS', 'GPO', 'DNS'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸ§', title: 'Administration Linux',
    context: 'ecole', category: 'SystÃ¨mes & Infrastructure',
    desc: 'Cours et TP sur l\'administration de serveurs Debian/Ubuntu : gestion des services (Apache, Bind9, DHCP), scripting Bash, permissions et pare-feu.',
    tags: ['Debian', 'Bash', 'Apache', 'iptables'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸ›¡ï¸', title: 'Initiation CybersÃ©curitÃ©',
    context: 'ecole', category: 'CybersÃ©curitÃ©',
    desc: 'Module de sensibilisation Ã  la cybersÃ©curitÃ© : scan de ports avec Nmap, analyse de trames avec Wireshark, identification de vulnÃ©rabilitÃ©s.',
    tags: ['Nmap', 'Wireshark', 'SÃ©curitÃ©', 'Analyse'],
    date: '2025', status: 'done'
  },
  {
    icon: 'ðŸ’¾', title: 'Base de DonnÃ©es SQL',
    context: 'ecole', category: 'DÃ©veloppement',
    desc: 'Conception et manipulation de bases de donnÃ©es relationnelles : modÃ©lisation MCD/MLD, requÃªtes SQL avancÃ©es, jointures, vues et procÃ©dures stockÃ©es.',
    tags: ['MySQL', 'SQL', 'MCD', 'PhpMyAdmin'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸ', title: 'Programmation Python',
    context: 'ecole', category: 'DÃ©veloppement',
    desc: 'Cours de programmation Python : algorithmique, structures de donnÃ©es, scripts d\'automatisation, interaction avec fichiers et API.',
    tags: ['Python 3', 'Algorithmique', 'Scripting'],
    date: '2024-2025', status: 'done'
  },
  {
    icon: 'ðŸ“‹', title: 'Projet d\'Ã‰preuve E5',
    context: 'ecole', category: 'Projets BTS',
    desc: 'Projet professionnel pour l\'Ã©preuve E5 du BTS SIO : conception, rÃ©alisation et documentation d\'une solution d\'infrastructure rÃ©seau complÃ¨te.',
    tags: ['BTS SIO', 'E5', 'Documentation', 'Infrastructure'],
    date: '2025', status: 'progress'
  },

  // â”€â”€â”€ ðŸ¢ ENTREPRISE â”€â”€â”€
  {
    icon: 'ðŸ”§', title: 'DÃ©ploiement GLPI',
    context: 'entreprise', category: 'Gestion de Parc',
    desc: 'Installation et configuration de GLPI pour la gestion du parc informatique : inventaire automatisÃ© via FusionInventory, gestion des tickets et suivi des actifs.',
    tags: ['GLPI', 'FusionInventory', 'ITSM', 'Helpdesk'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸ“¡', title: 'Administration Active Directory',
    context: 'entreprise', category: 'Infrastructure',
    desc: 'Gestion quotidienne de l\'AD en production : crÃ©ation de comptes, gestion des droits, GPO de sÃ©curitÃ©, scripts PowerShell d\'automatisation des tÃ¢ches rÃ©currentes.',
    tags: ['AD', 'PowerShell', 'GPO', 'Production'],
    date: '2024-2025', status: 'done'
  },
  {
    icon: 'â˜ï¸', title: 'Infrastructure VMware',
    context: 'entreprise', category: 'Virtualisation',
    desc: 'Administration de l\'infrastructure VMware ESXi/vSphere : crÃ©ation et gestion de VMs, snapshots, surveillance des ressources, migration et maintenance.',
    tags: ['VMware', 'ESXi', 'vSphere', 'VMs'],
    date: '2024', status: 'done'
  },
  {
    icon: 'ðŸŽ«', title: 'Support Utilisateurs N1/N2',
    context: 'entreprise', category: 'Support & Helpdesk',
    desc: 'RÃ©solution de tickets de support de niveau 1 et 2 : diagnostic rÃ©seau, dÃ©pannage postes de travail, gestion des imprimantes, assistance Ã  distance.',
    tags: ['Helpdesk', 'Diagnostic', 'Support', 'Ticketing'],
    date: '2024-2025', status: 'done'
  },
  {
    icon: 'ðŸŒ', title: 'Maintenance RÃ©seau',
    context: 'entreprise', category: 'RÃ©seau',
    desc: 'Participation Ã  la maintenance de l\'infrastructure rÃ©seau : cÃ¢blage, configuration switchs, diagnostic de pannes, surveillance avec outils de monitoring.',
    tags: ['RÃ©seau', 'Switch', 'Monitoring', 'CÃ¢blage'],
    date: '2024-2025', status: 'done'
  },
  {
    icon: 'ðŸ”', title: 'Durcissement SÃ©curitÃ©',
    context: 'entreprise', category: 'SÃ©curitÃ©',
    desc: 'Participation au renforcement de la sÃ©curitÃ© du SI : mise Ã  jour des politiques de mots de passe, audit des accÃ¨s, configuration pare-feu, sensibilisation utilisateurs. Mise en place de VPN avec tunnels SSL et IPsec, ainsi que dÃ©ploiement de l\'antivirus ESET sur le parc informatique.',
    tags: ['SÃ©curitÃ©', 'Pare-feu', 'Audit', 'Hardening', 'VPN SSL', 'IPsec', 'ESET'],
    date: '2025', status: 'progress'
  },

  // â”€â”€â”€ ðŸ  PERSONNEL â”€â”€â”€
  {
    icon: 'ðŸ›¡ï¸', title: 'Tests de sÃ©curitÃ©',
    context: 'perso', category: 'CybersÃ©curitÃ©',
    desc: 'Environnement de test personnel pour la pratique du pentest : machines vulnÃ©rables (HackTheBox, TryHackMe), outils Kali Linux. Utilisation de Windows Sandbox comme bac Ã  sable isolÃ© pour analyser des fichiers suspects et tester l\'exploitation de failles de sÃ©curitÃ© en toute sÃ©curitÃ©.',
    tags: ['Kali Linux', 'HackTheBox', 'TryHackMe', 'Pentest', 'Windows Sandbox'],
    date: '2025', status: 'done'
  },
  {
    icon: 'ðŸ’»', title: 'Serveur personnel',
    context: 'perso', category: 'Infrastructure',
    desc: 'Mise en place d\'un serveur personnel pour apprendre et expÃ©rimenter : virtualisation avec Proxmox, dÃ©ploiement de services essentiels (DHCP, Active Directory), serveur de fichiers (SRV APP) et serveur TSE pour l\'accÃ¨s bureau Ã  distance.',
    tags: ['Proxmox', 'DHCP', 'Active Directory', 'TSE', 'Serveur de fichiers'],
    date: '2024-2025', status: 'done'
  }
];

function initProjets() {
  const container = document.getElementById('projetsContent');
  if (!container) return;
  renderProjets('all');
}

function switchProjetTab(tabEl, filter) {
  document.querySelectorAll('.projets-tab').forEach(t => t.classList.remove('active'));
  tabEl.classList.add('active');
  renderProjets(filter);
}

function renderProjets(filter) {
  const container = document.getElementById('projetsContent');
  if (!container) return;

  const filtered = filter === 'all' ? projetsData : projetsData.filter(p => p.context === filter);

  // Group by category
  const groups = {};
  filtered.forEach(p => {
    if (!groups[p.category]) groups[p.category] = [];
    groups[p.category].push(p);
  });

  // Update counts
  const countAll = document.getElementById('countAll');
  const countEcole = document.getElementById('countEcole');
  const countEntreprise = document.getElementById('countEntreprise');
  const countPerso = document.getElementById('countPerso');
  if (countAll) countAll.textContent = projetsData.length;
  if (countEcole) countEcole.textContent = projetsData.filter(p => p.context === 'ecole').length;
  if (countEntreprise) countEntreprise.textContent = projetsData.filter(p => p.context === 'entreprise').length;
  if (countPerso) countPerso.textContent = projetsData.filter(p => p.context === 'perso').length;

  const contextLabels = { ecole: 'Ã‰cole', entreprise: 'Entreprise', perso: 'Personnel' };
  const statusLabels = { done: 'TerminÃ©', progress: 'En cours', planned: 'PlanifiÃ©' };

  let html = '';
  for (const [cat, items] of Object.entries(groups)) {
    html += `
      <div class="projets-category">
        <div class="projets-category-header">
          <span class="projets-category-icon">ðŸ“‚</span>
          <span class="projets-category-title">${cat}</span>
          <span class="projets-category-count">${items.length} Ã©lÃ©ment${items.length > 1 ? 's' : ''}</span>
        </div>
    `;
    items.forEach(p => {
      html += `
        <div class="projet-card" onclick="toggleProjetDesc(this)">
          <div class="projet-card-icon">${p.icon}</div>
          <div class="projet-card-body">
            <div class="projet-card-title">
              ${p.title}
              <span class="projet-card-context ${p.context}">${contextLabels[p.context]}</span>
            </div>
            <div class="projet-card-desc">${p.desc}</div>
            <div class="projet-card-footer">
              ${p.tags.map(t => `<span class="projet-card-tag">${t}</span>`).join('')}
              <span class="projet-card-date">ðŸ“… ${p.date}</span>
            </div>
          </div>
          <div class="projet-card-status ${p.status}" title="${statusLabels[p.status]}"></div>
        </div>
      `;
    });
    html += `</div>`;
  }

  container.innerHTML = html;
}

function toggleProjetDesc(card) {
  const desc = card.querySelector('.projet-card-desc');
  desc.style.display = desc.style.display === 'none' ? '' : 'none';
}

// ============================
// CONTACT FORM (FormSubmit.co)
// ============================
const sentEmails = [];
let currentMailFolder = 'inbox';

function handleContactSubmit(e) {
  e.preventDefault();
  const btn = document.getElementById('mailSendBtn');
  const status = document.getElementById('mailStatus');
  const form = e.target;

  if (!btn || !status) return;

  btn.disabled = true;
  btn.textContent = 'â³ Envoi...';
  btn.classList.add('sending');
  status.textContent = 'Envoi en cours...';

  const fromEmail = document.getElementById('contactFrom').value;
  const fromName = document.getElementById('contactName').value;
  const subject = document.getElementById('contactSubject').value;
  const message = document.getElementById('contactMessage').value;

  fetch('https://formsubmit.co/ajax/aymen.louraghi38@gmail.com', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      name: fromName,
      email: fromEmail,
      _subject: subject,
      message: message,
      _captcha: 'false',
      _template: 'table',
      _replyto: fromEmail
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Store sent email
      sentEmails.push({
        from: fromName,
        email: fromEmail,
        subject: subject,
        message: message,
        date: new Date()
      });
      saveSentEmails();
      updateSentCount();

      const overlay = document.getElementById('mailSentOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        overlay.className = 'mail-sent-overlay';
        overlay.innerHTML = `
          <div class="mail-sent-icon">âœ…</div>
          <div class="mail-sent-title">Message envoyÃ© avec succÃ¨s !</div>
          <div class="mail-sent-sub">Votre email a Ã©tÃ© envoyÃ© Ã  aymen.louraghi38@gmail.com</div>
          <div class="mail-sent-sub">Je vous rÃ©pondrai dans les plus brefs dÃ©lais.</div>
          <button onclick="closeSentOverlay()" style="margin-top:1rem;padding:8px 24px;background:#0078d4;color:#fff;border:none;border-radius:4px;cursor:pointer;font-family:var(--font);font-weight:600;">OK</button>
        `;
      }
      showNotification('ðŸ“¤ Message envoyÃ© !', 'Votre email a bien Ã©tÃ© envoyÃ© Ã  Aymen.');
      form.reset();
      status.textContent = 'Message envoyÃ© âœ“';
    } else {
      throw new Error('Envoi Ã©chouÃ©');
    }
    btn.disabled = false;
    btn.textContent = 'ðŸ“¤ Envoyer';
    btn.classList.remove('sending');
  })
  .catch(function(error) {
    console.error('FormSubmit error:', error);
    const mailtoUrl = 'mailto:aymen.louraghi38@gmail.com'
      + '?subject=' + encodeURIComponent(subject)
      + '&body=' + encodeURIComponent('De: ' + fromName + ' (' + fromEmail + ')\n\n' + message);
    window.open(mailtoUrl, '_blank');
    showNotification('ðŸ“§ Redirection', 'Ouverture de votre client mail...');
    btn.disabled = false;
    btn.textContent = 'ðŸ“¤ Envoyer';
    btn.classList.remove('sending');
    status.textContent = 'PrÃªt';
  });
}

function updateSentCount() {
  const badge = document.getElementById('sentCount');
  if (badge) {
    badge.textContent = sentEmails.length;
    badge.style.display = sentEmails.length > 0 ? '' : 'none';
  }
}

function switchMailFolder(el, folder) {
  currentMailFolder = folder;
  // Update active folder
  const folders = el.closest('.mail-folders');
  if (folders) folders.querySelectorAll('.mail-folder').forEach(f => f.classList.remove('active'));
  el.classList.add('active');

  const mailMain = el.closest('.mail-container').querySelector('.mail-main');
  if (!mailMain) return;

  if (folder === 'sent') {
    renderSentView(mailMain);
  } else if (folder === 'inbox') {
    renderInboxView(mailMain);
  } else if (folder === 'drafts') {
    renderEmptyFolder(mailMain, 'ðŸ“', 'Aucun brouillon');
  } else {
    showComposeView();
  }
}

function renderSentView(mailMain) {
  if (sentEmails.length === 0) {
    mailMain.innerHTML = `
      <div class="mail-toolbar">
        <button class="mail-toolbar-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
      </div>
      <div class="mail-list-empty">
        <div class="mail-list-empty-icon">ðŸ“¤</div>
        <div>Aucun message envoyÃ©</div>
        <div style="font-size:0.75rem;">Les messages envoyÃ©s apparaÃ®tront ici.</div>
      </div>
    `;
    return;
  }

  let listHTML = `
    <div class="mail-toolbar">
      <button class="mail-toolbar-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
      <div class="mail-toolbar-sep"></div>
      <span style="font-size:0.75rem;color:var(--text-muted);">${sentEmails.length} message${sentEmails.length > 1 ? 's' : ''}</span>
    </div>
    <div class="mail-list">
  `;

  sentEmails.slice().reverse().forEach((mail, i) => {
    const realIdx = sentEmails.length - 1 - i;
    const time = mail.date.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
    const date = mail.date.toLocaleDateString('fr-FR', {day:'2-digit', month:'short'});
    const initials = mail.from.split(' ').map(w => w[0]).join('').toUpperCase().slice(0,2);
    listHTML += `
      <div class="mail-list-item" onclick="openSentMail(${realIdx})">
        <div class="mail-list-avatar">${initials}</div>
        <div class="mail-list-content">
          <div class="mail-list-header">
            <span class="mail-list-sender">Ã€ : aymen.louraghi38@gmail.com</span>
            <span class="mail-list-time">${date} ${time}</span>
          </div>
          <div class="mail-list-subject">${mail.subject}</div>
          <div class="mail-list-preview">${mail.message.substring(0, 80)}${mail.message.length > 80 ? '...' : ''}</div>
        </div>
      </div>
    `;
  });

  listHTML += '</div>';
  mailMain.innerHTML = listHTML;
}

function openSentMail(idx) {
  const mail = sentEmails[idx];
  if (!mail) return;
  const mailMain = document.querySelector('.mail-container .mail-main');
  if (!mailMain) return;

  const date = mail.date.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
  const time = mail.date.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});

  mailMain.innerHTML = `
    <div class="mail-toolbar">
      <button class="mail-toolbar-btn" onclick="switchMailFolder(document.querySelector('.mail-folder[onclick*=sent]'), 'sent')">â¬… Retour</button>
      <div class="mail-toolbar-sep"></div>
      <button class="mail-toolbar-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
    </div>
    <div class="mail-read-view">
      <div class="mail-read-header">
        <div class="mail-read-subject">${mail.subject}</div>
        <div class="mail-read-meta">
          <div><strong>De :</strong> ${mail.from} &lt;${mail.email}&gt;</div>
          <div><strong>Ã€ :</strong> aymen.louraghi38@gmail.com</div>
          <div><strong>Date :</strong> ${date} Ã  ${time}</div>
        </div>
      </div>
      <div class="mail-read-body">${mail.message}</div>
    </div>
  `;
}

function renderInboxView(mailMain) {
  const now = new Date();
  const time = now.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
  mailMain.innerHTML = `
    <div class="mail-toolbar">
      <button class="mail-toolbar-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
    </div>
    <div class="mail-list">
      <div class="mail-list-item" style="background:rgba(0,120,212,0.08);">
        <div class="mail-list-avatar" style="background:linear-gradient(135deg,#0078d4,#00a0c4);">AL</div>
        <div class="mail-list-content">
          <div class="mail-list-header">
            <span class="mail-list-sender">Aymen Louraghi</span>
            <span class="mail-list-time">Aujourd'hui</span>
          </div>
          <div class="mail-list-subject">Bienvenue sur mon portfolio !</div>
          <div class="mail-list-preview">Merci de visiter mon portfolio. N'hÃ©sitez pas Ã  me contacter via le bouton Nouveau message.</div>
        </div>
      </div>
    </div>
  `;
}

function renderEmptyFolder(mailMain, icon, text) {
  mailMain.innerHTML = `
    <div class="mail-toolbar">
      <button class="mail-toolbar-btn" onclick="showComposeView()">âœï¸ Nouveau message</button>
    </div>
    <div class="mail-list-empty">
      <div class="mail-list-empty-icon">${icon}</div>
      <div>${text}</div>
    </div>
  `;
}

function showComposeView() {
  // Re-render the full compose view
  const contact = document.querySelector('.mail-container .mail-main');
  if (!contact) return;
  contact.innerHTML = `
    <div class="mail-toolbar">
      <button class="mail-toolbar-btn" onclick="document.getElementById('contactForm').requestSubmit()">ðŸ“¤ Envoyer</button>
      <div class="mail-toolbar-sep"></div>
      <button class="mail-toolbar-btn">ðŸ“Ž Joindre</button>
      <button class="mail-toolbar-btn" onclick="resetContactForm()">ðŸ—‘ï¸ Supprimer</button>
      <div style="flex:1;"></div>
      <div class="contact-links" style="margin:0;gap:6px;">
        <a class="contact-link" href="mailto:aymen.louraghi38@gmail.com" style="padding:5px 10px;font-size:0.7rem;">
          <span class="contact-link-icon" style="font-size:0.85rem;">ðŸ“§</span> Email
        </a>
        <a class="contact-link" href="https://fr.linkedin.com/in/aymen-louraghi-887ab9312" target="_blank" style="padding:5px 10px;font-size:0.7rem;">
          <span class="contact-link-icon" style="font-size:0.85rem;">ðŸ’¼</span> LinkedIn
        </a>
      </div>
    </div>
    <form class="mail-compose-area" id="contactForm" onsubmit="handleContactSubmit(event)">
      <div class="mail-compose-fields">
        <div class="mail-field-row">
          <span class="mail-field-label">De :</span>
          <input class="mail-field-input" id="contactFrom" type="email" name="from_email" placeholder="votre@email.com" required>
        </div>
        <div class="mail-field-row">
          <span class="mail-field-label">Ã€ :</span>
          <span class="mail-field-static">aymen.louraghi38@gmail.com</span>
        </div>
        <div class="mail-field-row">
          <span class="mail-field-label">Nom :</span>
          <input class="mail-field-input" id="contactName" type="text" name="from_name" placeholder="Votre nom" required>
        </div>
        <div class="mail-field-row">
          <span class="mail-field-label">Objet :</span>
          <input class="mail-field-input" id="contactSubject" type="text" name="subject" placeholder="Objet du message" required>
        </div>
      </div>
      <div class="mail-body-area">
        <textarea class="mail-body-textarea" id="contactMessage" name="message" placeholder="RÃ©digez votre message ici..." required></textarea>
      </div>
      <div class="mail-statusbar">
        <span id="mailStatus">PrÃªt</span>
        <button type="submit" class="mail-send-btn" id="mailSendBtn">ðŸ“¤ Envoyer</button>
      </div>
    </form>
  `;
}

function resetContactForm() {
  const form = document.getElementById('contactForm');
  if (form) form.reset();
  const overlay = document.getElementById('mailSentOverlay');
  if (overlay) overlay.style.display = 'none';
  const status = document.getElementById('mailStatus');
  if (status) status.textContent = 'PrÃªt';
}

function closeSentOverlay() {
  const overlay = document.getElementById('mailSentOverlay');
  if (overlay) overlay.style.display = 'none';
  // Switch to sent folder after closing overlay
  const sentFolder = document.querySelector('.mail-folder[onclick*="sent"]');
  if (sentFolder && sentEmails.length > 0) {
    switchMailFolder(sentFolder, 'sent');
  }
}

// ============================
// CV DOWNLOAD
// ============================
function downloadCV() {
  const cvUrl = 'CV_2026-02-18_Aymen_LOURAGHI.pdf';
  const a = document.createElement('a');
  a.href = cvUrl;
  a.download = 'CV_Aymen_Louraghi.pdf';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  showNotification('ðŸ“„ TÃ©lÃ©chargement', 'TÃ©lÃ©chargement du CV en cours...');
}

// ============================
// WINDOW MANAGEMENT
// ============================
function openWindow(id) {
  // If already open, focus it
  if (state.windows[id]) {
    const win = state.windows[id];
    if (win.classList.contains('minimized')) {
      win.classList.remove('minimized');
    }
    focusWindow(id);
    return;
  }

  const template = getWindowContent(id);
  if (!template) return;

  const win = document.createElement('div');
  win.className = 'os-window focused';
  win.id = 'window-' + id;
  win.dataset.windowId = id;
  win.style.width = template.width + 'px';
  win.style.height = template.height + 'px';
  // Center with offset based on number of windows
  const offset = Object.keys(state.windows).length * 30;
  win.style.left = Math.max(60, (window.innerWidth - template.width) / 2 + offset) + 'px';
  win.style.top = Math.max(30, (window.innerHeight - template.height - 52) / 2 + offset) + 'px';

  // Restore saved position from localStorage
  const savedPos = getSavedWindowPosition(id);
  if (savedPos && !isMobile()) {
    win.style.left = savedPos.left;
    win.style.top = savedPos.top;
    win.style.width = savedPos.width;
    win.style.height = savedPos.height;
  }

  win.style.zIndex = ++state.zCounter;

  win.innerHTML = `
    <div class="window-titlebar" data-drag="true">
      <span class="window-titlebar-icon">${template.icon}</span>
      <span class="window-titlebar-text">${template.title}</span>
      <div class="window-controls">
        <button class="window-ctrl-btn minimize-btn" onclick="minimizeWindow('${id}')" title="RÃ©duire">â”€</button>
        <button class="window-ctrl-btn maximize-btn" onclick="maximizeWindow('${id}')" title="Agrandir">â–¡</button>
        <button class="window-ctrl-btn close-btn" onclick="closeWindow('${id}')" title="Fermer">âœ•</button>
      </div>
    </div>
    <div class="window-body">${template.content}</div>
    <div class="resize-handle" data-resize="true"></div>
  `;

  document.getElementById('desktop').appendChild(win);
  state.windows[id] = win;
  state.windowOrder.push(id);
  focusWindow(id);
  updateTaskbar();

  // Init drag (skipped on mobile)
  initDrag(win, id);
  // Init resize (skipped on mobile)
  if (!isMobile()) initResize(win);
  // Window-specific init
  if (id === 'accueil') initTypingEffect();
  if (id === 'terminal') initTerminal();
  if (id === 'projets') initProjets();
  if (id === 'scolarite') initScolarite();

  // Click to focus
  win.addEventListener('mousedown', () => focusWindow(id));
}

function closeWindow(id) {
  const win = state.windows[id];
  if (!win) return;
  win.classList.add('closing');
  setTimeout(() => {
    win.remove();
    delete state.windows[id];
    state.windowOrder = state.windowOrder.filter(w => w !== id);
    updateTaskbar();
  }, 250);
}

function minimizeWindow(id) {
  const win = state.windows[id];
  if (!win) return;
  win.classList.add('minimized');
  updateTaskbar();
}

function maximizeWindow(id) {
  const win = state.windows[id];
  if (!win) return;
  if (win.classList.contains('maximized')) {
    win.classList.remove('maximized');
    // Restore saved position
    if (win._savedRect) {
      win.style.left = win._savedRect.left;
      win.style.top = win._savedRect.top;
      win.style.width = win._savedRect.width;
      win.style.height = win._savedRect.height;
    }
  } else {
    // Save current position
    win._savedRect = {
      left: win.style.left,
      top: win.style.top,
      width: win.style.width,
      height: win.style.height,
    };
    win.classList.add('maximized');
  }
}

function focusWindow(id) {
  Object.values(state.windows).forEach(w => w.classList.remove('focused'));
  const win = state.windows[id];
  if (win) {
    win.style.zIndex = ++state.zCounter;
    win.classList.add('focused');
  }
  updateTaskbar();
}

function updateTaskbar() {
  // Update active states on taskbar buttons
  document.querySelectorAll('#taskbarApps .taskbar-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  // Mark active for open windows
  for (const id of Object.keys(state.windows)) {
    const btns = document.querySelectorAll('#taskbarApps .taskbar-btn');
    btns.forEach(btn => {
      const title = btn.getAttribute('title');
      const map = {
        'Accueil': 'accueil',
        'Ã€ Propos': 'apropos',
        'RÃ©alisations': 'realisations',
        'Projets': 'projets',
        'ScolaritÃ©': 'scolarite',
        'Contact': 'contact',
        'Terminal': 'terminal',
      'CV': 'cv'
      };
      if (map[title] === id && !state.windows[id].classList.contains('minimized')) {
        btn.classList.add('active');
      }
    });
  }
}

// ============================
// MOBILE DETECTION
// ============================
function isMobile() {
  return window.innerWidth <= 768;
}

// ============================
// DRAG & DROP (leak-free, touch-aware)
// ============================
function initDrag(win, id) {
  if (isMobile()) return; // No drag on mobile, windows are fullscreen
  const titlebar = win.querySelector('[data-drag="true"]');
  let isDragging = false;
  let startX, startY, origLeft, origTop;

  function onMouseMove(e) {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    win.style.left = (origLeft + dx) + 'px';
    win.style.top = Math.max(0, origTop + dy) + 'px';
  }

  function onMouseUp() {
    if (!isDragging) return;
    isDragging = false;
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
    // Snap to top edge = maximize
    if (parseInt(win.style.top) <= 0 && !win.classList.contains('maximized')) {
      maximizeWindow(id);
    } else {
      saveWindowPosition(id);
    }
  }

  titlebar.addEventListener('mousedown', e => {
    if (e.target.closest('.window-controls')) return;
    if (win.classList.contains('maximized')) return;
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    origLeft = win.offsetLeft;
    origTop = win.offsetTop;
    focusWindow(id);
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
    e.preventDefault();
  });

  // Double-click titlebar to maximize
  titlebar.addEventListener('dblclick', e => {
    if (e.target.closest('.window-controls')) return;
    maximizeWindow(id);
  });
}

// ============================
// RESIZE (leak-free)
// ============================
function initResize(win) {
  const handle = win.querySelector('[data-resize="true"]');
  if (!handle) return;
  let isResizing = false;
  let startX, startY, startW, startH;

  function onMouseMove(e) {
    if (!isResizing) return;
    const w = Math.max(400, startW + (e.clientX - startX));
    const h = Math.max(300, startH + (e.clientY - startY));
    win.style.width = w + 'px';
    win.style.height = h + 'px';
  }

  function onMouseUp() {
    if (!isResizing) return;
    isResizing = false;
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
    saveWindowPosition(win.dataset.windowId);
  }

  handle.addEventListener('mousedown', e => {
    if (win.classList.contains('maximized')) return;
    isResizing = true;
    startX = e.clientX;
    startY = e.clientY;
    startW = win.offsetWidth;
    startH = win.offsetHeight;
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
    e.preventDefault();
    e.stopPropagation();
  });
}

// ============================
// TYPING EFFECT (Accueil)
// ============================
function initTypingEffect() {
  const lines = [
    'echo "Bienvenue sur mon portfolio interactif"',
    'cat parcours.txt â†’ BTS SIO SISR | Alternance @ Konvergence',
    'nmap -sV compÃ©tences â†’ RÃ©seaux, SÃ©curitÃ©, SystÃ¨mes...',
    'status â†’ MotivÃ© et prÃªt Ã  relever de nouveaux dÃ©fis ! ðŸš€'
  ];
  const el = document.getElementById('typedText');
  if (!el) return;

  let lineIndex = 0;
  let charIndex = 0;

  function type() {
    if (lineIndex >= lines.length) {
      lineIndex = 0;
      el.innerHTML = '';
      setTimeout(type, 1500);
      return;
    }

    if (charIndex <= lines[lineIndex].length) {
      const line = lines[lineIndex];
      const displayLine = line.substring(0, charIndex);
      const allPrev = lines.slice(0, lineIndex).join('\n');
      el.innerHTML = (allPrev ? allPrev + '\n' : '') + displayLine;
      charIndex++;
      setTimeout(type, 35 + Math.random() * 25);
    } else {
      charIndex = 0;
      lineIndex++;
      setTimeout(type, 800);
    }
  }
  setTimeout(type, 500);
}

// ============================
// TERMINAL (with command history)
// ============================
function initTerminal() {
  const input = document.getElementById('terminalInput');
  if (!input) return;
  setTimeout(() => input.focus(), 100);

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const cmd = input.value.trim().toLowerCase();
      input.value = '';
      if (cmd) {
        state.terminalHistory.push(cmd);
        state.terminalHistoryIndex = state.terminalHistory.length;
      }
      processCommand(cmd);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (state.terminalHistoryIndex > 0) {
        state.terminalHistoryIndex--;
        input.value = state.terminalHistory[state.terminalHistoryIndex];
      }
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (state.terminalHistoryIndex < state.terminalHistory.length - 1) {
        state.terminalHistoryIndex++;
        input.value = state.terminalHistory[state.terminalHistoryIndex];
      } else {
        state.terminalHistoryIndex = state.terminalHistory.length;
        input.value = '';
      }
    } else if (e.key === 'l' && e.ctrlKey) {
      e.preventDefault();
      const output = document.getElementById('terminalOutput');
      if (output) output.innerHTML = '';
    }
  });

  // Keep focus on terminal input when clicking terminal
  const termContainer = input.closest('.terminal-container');
  if (termContainer) {
    termContainer.addEventListener('click', () => input.focus());
  }
}

function processCommand(cmd) {
  const output = document.getElementById('terminalOutput');
  if (!output) return;

  // Echo the command
  output.innerHTML += `<div><span class="t-prompt">aymen@portfolio:~$</span> <span class="t-cmd">${escapeHtml(cmd)}</span></div>`;

  if (!cmd) {
    scrollTerminal();
    return;
  }

  const commands = {
    help: () => {
      return `<div class="t-info">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
<div class="t-info">  Commandes disponibles :</div>
<div class="t-info">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
<div><span class="t-cmd">help</span>      <span class="t-result">â€” Affiche cette aide</span></div>
<div><span class="t-cmd">about</span>     <span class="t-result">â€” Ã€ propos de moi</span></div>
<div><span class="t-cmd">skills</span>    <span class="t-result">â€” Mes compÃ©tences</span></div>
<div><span class="t-cmd">projects</span>  <span class="t-result">â€” Mes projets</span></div>
<div><span class="t-cmd">contact</span>   <span class="t-result">â€” Mes coordonnÃ©es</span></div>
<div><span class="t-cmd">open</span>      <span class="t-result">â€” Ouvrir une fenÃªtre (ex: open projets)</span></div>
<div><span class="t-cmd">wallpaper</span> <span class="t-result">â€” Changer le fond d'Ã©cran</span></div>
<div><span class="t-cmd">theme</span>     <span class="t-result">â€” Changer la couleur d'accent</span></div>
<div><span class="t-cmd">ping</span>      <span class="t-result">â€” Ping simulation</span></div>
<div><span class="t-cmd">whoami</span>    <span class="t-result">â€” IdentitÃ©</span></div>
<div><span class="t-cmd">date</span>      <span class="t-result">â€” Date et heure</span></div>
<div><span class="t-cmd">neofetch</span>  <span class="t-result">â€” Infos systÃ¨me</span></div>
<div><span class="t-cmd">history</span>   <span class="t-result">â€” Historique des commandes</span></div>
<div><span class="t-cmd">matrix</span>    <span class="t-result">â€” ðŸ”´ðŸ’Š ou ðŸ”µðŸ’Š ?</span></div>
<div><span class="t-cmd">clear</span>     <span class="t-result">â€” Nettoyer le terminal</span></div>
<div><span class="t-cmd">exit</span>      <span class="t-result">â€” Fermer le terminal</span></div>
<div>&nbsp;</div>
<div class="t-result"><em>â†‘/â†“ pour naviguer l'historique â€¢ Ctrl+L pour effacer</em></div>`;
    },
    about: () => {
      return `<div class="t-info">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</div>
<div class="t-info">â•‘  Aymen Louraghi â€” 19 ans          â•‘</div>
<div class="t-info">â•‘  BTS SIO SISR â€” CFP Charmilles   â•‘</div>
<div class="t-info">â•‘  Alternance : Konvergence         â•‘</div>
<div class="t-info">â•‘  Passion : RÃ©seaux & CybersÃ©curitÃ©â•‘</div>
<div class="t-info">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>`;
    },
    skills: () => {
      return `<div class="t-result">ðŸŒ RÃ©seaux Cisco â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%</div>
<div class="t-result">ðŸ§ Linux         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%</div>
<div class="t-result">ðŸªŸ Windows Server â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 82%</div>
<div class="t-result">ðŸ›¡ï¸ CybersÃ©curitÃ©  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%</div>
<div class="t-result">ðŸ“¡ Active Dir.    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 78%</div>
<div class="t-result">ðŸ Python         â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%</div>
<div class="t-result">ðŸ”§ GLPI/ITSM      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 75%</div>
<div class="t-result">â˜ï¸ Virtualisation  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 72%</div>`;
    },
    projects: () => {
      return `<div class="t-result">ðŸ“¡ Active Directory â€” Infrastructure</div>
<div class="t-result">ðŸŒ Infrastructure Cisco â€” RÃ©seau</div>
<div class="t-result">ðŸ”§ GLPI â€” Gestion de parc</div>
<div class="t-result">ðŸ§ Serveur Linux â€” SystÃ¨me</div>
<div class="t-result">ðŸ›¡ï¸ Audit SÃ©curitÃ© â€” CybersÃ©curitÃ©</div>
<div class="t-result">â˜ï¸ Virtualisation VMware â€” Infrastructure</div>`;
    },
    contact: () => {
      return `<div class="t-result">ðŸ“§ aymen.louraghi38@gmail.com</div>
<div class="t-result">ðŸ’¼ LinkedIn : fr.linkedin.com/in/aymen-louraghi-887ab9312</div>`;
    },
    ping: () => {
      return `<div class="t-result">PING portfolio.aymen.dev (127.0.0.1) 56(84) bytes of data.</div>
<div class="t-result">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.028 ms</div>
<div class="t-result">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.031 ms</div>
<div class="t-result">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.024 ms</div>
<div class="t-result">--- portfolio.aymen.dev ping statistics ---</div>
<div class="t-result">3 packets transmitted, 3 received, 0% packet loss</div>`;
    },
    whoami: () => `<div class="t-result">aymen (Aymen Louraghi) â€” Ã‰tudiant BTS SIO SISR</div>`,
    date: () => `<div class="t-result">${new Date().toLocaleString('fr-FR', { dateStyle:'full', timeStyle:'medium' })}</div>`,
    neofetch: () => {
      return `<div class="t-info">        .--.        </div>
<div class="t-info">       |o  o|       <span class="t-result">aymen@portfolio</span></div>
<div class="t-info">       | .. |       <span class="t-result">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div>
<div class="t-info">       |    |       <span class="t-result">OS: AymenOS v2.0</span></div>
<div class="t-info">       '----'       <span class="t-result">Host: Portfolio Web</span></div>
<div class="t-info">                    <span class="t-result">Kernel: HTML5/CSS3/JS</span></div>
<div class="t-info">                    <span class="t-result">Uptime: depuis 2024</span></div>
<div class="t-info">                    <span class="t-result">Shell: terminal.js</span></div>
<div class="t-info">                    <span class="t-result">Theme: CyberDark</span></div>
<div class="t-info">                    <span class="t-result">CPU: Motivation @ 100%</span></div>`;
    },
    matrix: () => {
      return `<div class="t-warn">Wake up, Aymen...</div>
<div class="t-warn">The Matrix has you...</div>
<div class="t-warn">Follow the white rabbit. ðŸ‡</div>
<div>&nbsp;</div>
<div class="t-result">01001000 01100101 01101100 01101100 01101111</div>`;
    },
    clear: () => {
      output.innerHTML = '';
      return '';
    },
    exit: () => {
      closeWindow('terminal');
      return '';
    },
    history: () => {
      if (state.terminalHistory.length === 0) {
        return `<div class="t-result">Aucune commande dans l'historique.</div>`;
      }
      return state.terminalHistory.map((c, i) =>
        `<div class="t-result">${String(i + 1).padStart(4, ' ')}  ${escapeHtml(c)}</div>`
      ).join('');
    }
  };

  // Handle wallpaper command
  if (cmd === 'wallpaper' || cmd.startsWith('wallpaper ')) {
    const name = cmd.split(' ')[1];
    if (!name) {
      output.innerHTML += `<div class="t-result">Fonds disponibles : ${Object.keys(WALLPAPER_NAMES).join(', ')}</div>`;
      output.innerHTML += `<div class="t-result">Usage : <span class="t-cmd">wallpaper &lt;nom&gt;</span></div>`;
    } else {
      if (WALLPAPER_NAMES[name]) {
        setWallpaper(name);
        output.innerHTML += `<div class="t-result">âœ… Fond d'Ã©cran "${WALLPAPER_NAMES[name]}" appliquÃ©.</div>`;
      } else {
        output.innerHTML += `<div class="t-error">Fond inconnu : '${escapeHtml(name)}'. Disponibles : ${Object.keys(WALLPAPER_NAMES).join(', ')}</div>`;
      }
    }
  }
  // Handle theme command
  else if (cmd === 'theme' || cmd.startsWith('theme ')) {
    const name = cmd.split(' ')[1];
    if (!name) {
      output.innerHTML += `<div class="t-result">Couleurs disponibles : ${Object.keys(ACCENT_COLORS).join(', ')}</div>`;
      output.innerHTML += `<div class="t-result">Usage : <span class="t-cmd">theme &lt;couleur&gt;</span></div>`;
    } else {
      if (ACCENT_COLORS[name]) {
        setAccentColor(name);
        output.innerHTML += `<div class="t-result">âœ… Couleur "${name}" appliquÃ©e.</div>`;
      } else {
        output.innerHTML += `<div class="t-error">Couleur inconnue : '${escapeHtml(name)}'. Disponibles : ${Object.keys(ACCENT_COLORS).join(', ')}</div>`;
      }
    }
  }
  // Handle 'open <window>' command
  else if (cmd.startsWith('open ')) {
    const target = cmd.split(' ')[1];
    const validWindows = ['accueil', 'apropos', 'realisations', 'projets', 'scolarite', 'contact', 'terminal'];
    if (validWindows.includes(target)) {
      output.innerHTML += `<div class="t-result">Ouverture de ${target}...</div>`;
      setTimeout(() => openWindow(target), 300);
    } else {
      output.innerHTML += `<div class="t-error">FenÃªtre inconnue : '${escapeHtml(target)}'. Disponibles : ${validWindows.join(', ')}</div>`;
    }
  } else {
    const handler = commands[cmd];
    if (handler) {
      const result = handler();
      if (result) output.innerHTML += result;
    } else {
      output.innerHTML += `<div class="t-error">Commande non reconnue : '${escapeHtml(cmd)}'. Tapez <span class="t-cmd">"help"</span> pour la liste des commandes.</div>`;
    }
  }

  if (cmd !== 'clear' && cmd !== 'exit') {
    output.innerHTML += '<div>&nbsp;</div>';
  }
  scrollTerminal();
}

function scrollTerminal() {
  const output = document.getElementById('terminalOutput');
  if (output) output.scrollTop = output.scrollHeight;
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// ============================
// AUTODESTRUCTION
// ============================
function triggerSelfDestruct() {
  if (state.selfDestructActive) return;
  state.selfDestructActive = true;

  const overlay = document.getElementById('glitchOverlay');
  const text = document.getElementById('glitchText');
  const fireContainer = document.getElementById('fireParticles');

  overlay.classList.add('active');
  text.classList.add('active');

  // Fire particles
  const colors = ['#ff5252', '#ff9800', '#ffc107', '#ff5722'];
  let particleInterval = setInterval(() => {
    for (let i = 0; i < 5; i++) {
      const p = document.createElement('div');
      p.className = 'fire-particle';
      p.style.left = Math.random() * 100 + '%';
      p.style.bottom = '0px';
      p.style.background = colors[Math.floor(Math.random() * colors.length)];
      p.style.width = p.style.height = (4 + Math.random() * 8) + 'px';
      p.style.animationDuration = (0.8 + Math.random() * 1.2) + 's';
      fireContainer.appendChild(p);
      setTimeout(() => p.remove(), 2000);
    }
  }, 50);

  // Shake effect
  document.body.style.animation = 'shake 0.1s infinite';
  const shakeStyle = document.createElement('style');
  shakeStyle.textContent = `
    @keyframes shake {
      0% { transform: translate(0); }
      25% { transform: translate(-3px, 2px); }
      50% { transform: translate(3px, -2px); }
      75% { transform: translate(-2px, -3px); }
      100% { transform: translate(2px, 3px); }
    }
  `;
  document.head.appendChild(shakeStyle);

  // Stop after 4 seconds
  setTimeout(() => {
    overlay.classList.remove('active');
    text.classList.remove('active');
    clearInterval(particleInterval);
    fireContainer.innerHTML = '';
    document.body.style.animation = '';
    shakeStyle.remove();
    state.selfDestructActive = false;
    showNotification('âœ… SystÃ¨me restaurÃ©', 'Autodestruction annulÃ©e. Le portfolio est intact !');
  }, 4000);
}

// ============================
// DESKTOP ICON SELECTION
// ============================
document.querySelectorAll('.desktop-icon').forEach(icon => {
  // Single tap to open on mobile, click to select on desktop
  icon.addEventListener('click', function(e) {
    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
    this.classList.add('selected');
    if (isMobile()) {
      const winId = this.dataset.window;
      if (winId) openWindow(winId);
    }
  });
});

// Click on desktop to deselect
document.getElementById('desktop').addEventListener('click', function(e) {
  if (e.target === this || e.target.closest('.particles')) {
    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
  }
});

// ============================
// KEYBOARD SHORTCUTS
// ============================
document.addEventListener('keydown', e => {
  // Escape to close start menu or focused window
  if (e.key === 'Escape') {
    if (state.startMenuOpen) {
      toggleStartMenu();
      return;
    }
    // Close topmost focused window
    const focused = Object.entries(state.windows).find(([, w]) => w.classList.contains('focused'));
    if (focused) closeWindow(focused[0]);
  }
  // Ctrl+Shift+T = open terminal
  if (e.key === 'T' && e.ctrlKey && e.shiftKey) {
    e.preventDefault();
    openWindow('terminal');
  }
});

// ============================
// INITIALIZE LOCALSTORAGE
// ============================
loadWallpaper();
loadAccentColor();
loadSentEmails();

</script>
</body>
</html>
